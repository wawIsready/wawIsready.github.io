<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Eiwen的前端小站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="web前端">
<meta property="og:type" content="website">
<meta property="og:title" content="Eiwen的前端小站">
<meta property="og:url" content="https://wawisready.github.io/page/2/index.html">
<meta property="og:site_name" content="Eiwen的前端小站">
<meta property="og:description" content="web前端">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Eiwen的前端小站">
<meta name="twitter:description" content="web前端">
  
    <link rel="alternate" href="/atom.xml" title="Eiwen的前端小站" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Eiwen的前端小站</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://wawisready.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-D3.js实现带动画效果的柱状图" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/17/D3.js实现带动画效果的柱状图/" class="article-date">
  <time datetime="2018-03-17T03:03:24.000Z" itemprop="datePublished">2018-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/17/D3.js实现带动画效果的柱状图/">D3.js 实现带动画效果的柱状图</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>先上效果图，如下图所示：<br><img src="https://img-blog.csdnimg.cn/20181102143913451.gif" alt="在这里插入图片描述"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"zh-cn"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;D3&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;style&gt;</span></span><br><span class="line"><span class="regexp">        body &#123;</span></span><br><span class="line"><span class="regexp">            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="regexp">            font-size: 14px;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        .bar &#123;</span></span><br><span class="line"><span class="regexp">            border: 1px solid #0b3536;</span></span><br><span class="line"><span class="regexp">            border-radius: 6px;</span></span><br><span class="line"><span class="regexp">            fill: #0098d8;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        #bar .barText &#123;</span></span><br><span class="line"><span class="regexp">            fill: #f5faf8;</span></span><br><span class="line"><span class="regexp">            font-weight: 500;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        .axisY text,</span></span><br><span class="line"><span class="regexp">        .axisX text,</span></span><br><span class="line"><span class="regexp">        .headerText text &#123;</span></span><br><span class="line"><span class="regexp">            fill: #0b3536;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        #bar svg &#123;</span></span><br><span class="line"><span class="regexp">            background-color: #f5faf8;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>style&gt;</span><br><span class="line">&lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div class='container'&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div id='bar'&gt;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="/</span><span class="keyword">static</span>/js/d3.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">    /** V4柱状图初始化 **/</span></span><br><span class="line"><span class="string">    function BarInit(width, height, rectHeight, rectPadding, padding, data) &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 获取x轴的数据</span></span><br><span class="line"><span class="string">        var Xdatas = data.map(function (d) &#123;</span></span><br><span class="line"><span class="string">            return d.key;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 获取y轴的数据</span></span><br><span class="line"><span class="string">        var values = data.map(function (d) &#123;</span></span><br><span class="line"><span class="string">            return d.value;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 创建X,Y轴比例尺</span></span><br><span class="line"><span class="string">        var xScale = d3.scaleBand().domain(Xdatas).rangeRound([0, width]).padding(0.1),</span></span><br><span class="line"><span class="string">            yScale = d3.scaleLinear().domain([0, d3.max(values)]).rangeRound([height, 0]);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 将svg容器添加到Dom中</span></span><br><span class="line"><span class="string">        var svg = d3.select('#bar').append('svg')</span></span><br><span class="line"><span class="string">            .attr('width', width + padding.left + padding.right)</span></span><br><span class="line"><span class="string">            .attr('height', height + padding.top + padding.bottom);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 将group元素添加到svg容器中</span></span><br><span class="line"><span class="string">        var g = svg.append('g')</span></span><br><span class="line"><span class="string">            .attr('transform', 'translate(' + padding.left + ',' + padding.top + ')');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 添加图表的表头</span></span><br><span class="line"><span class="string">        g.attr('class', 'headerText')</span></span><br><span class="line"><span class="string">            .append('text')</span></span><br><span class="line"><span class="string">            .attr('transform', 'translate(' + (width / 2) + ',' + (-padding.top / 2) + ')')</span></span><br><span class="line"><span class="string">            .attr('text-anchor', 'middle')</span></span><br><span class="line"><span class="string">            .attr('font-weight', 600)</span></span><br><span class="line"><span class="string">            .text('Simple Bar Chart');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 添加X轴</span></span><br><span class="line"><span class="string">        g.append('g')</span></span><br><span class="line"><span class="string">            .attr('class', 'axisX')</span></span><br><span class="line"><span class="string">            .attr('transform', 'translate(0,' + height + ')')</span></span><br><span class="line"><span class="string">            .call(d3.axisBottom(xScale))</span></span><br><span class="line"><span class="string">            .attr('font-weight', 'bold');</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 添加Y轴</span></span><br><span class="line"><span class="string">        g.append('g')</span></span><br><span class="line"><span class="string">            .attr('class', 'axisY')</span></span><br><span class="line"><span class="string">            .call(d3.axisLeft(yScale).ticks(10));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 创建盛放矩形的容器</span></span><br><span class="line"><span class="string">        var chart = g.selectAll('.bar')</span></span><br><span class="line"><span class="string">            .data(data)</span></span><br><span class="line"><span class="string">            .enter().append('g')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 添加矩形元素</span></span><br><span class="line"><span class="string">        chart.append('rect')</span></span><br><span class="line"><span class="string">            .attr('class', 'bar')</span></span><br><span class="line"><span class="string">            .attr('x', function (d) &#123;</span></span><br><span class="line"><span class="string">                return xScale(d.key);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            //动画开始</span></span><br><span class="line"><span class="string">            .attr("</span>y<span class="string">", function (d) &#123;</span></span><br><span class="line"><span class="string">                var min = yScale.domain()[0];</span></span><br><span class="line"><span class="string">                return yScale(min);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .attr("</span>height<span class="string">", function (d) &#123;</span></span><br><span class="line"><span class="string">                return 0;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .transition()</span></span><br><span class="line"><span class="string">            .delay(function (d, i) &#123;</span></span><br><span class="line"><span class="string">                return i * 200;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .duration(2000)</span></span><br><span class="line"><span class="string">            .ease(d3.easeBounceIn)</span></span><br><span class="line"><span class="string">            //动画结束</span></span><br><span class="line"><span class="string">            .attr('y', function (d) &#123;</span></span><br><span class="line"><span class="string">                return yScale(d.value);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .attr('height', function (d) &#123;</span></span><br><span class="line"><span class="string">                return height - yScale(d.value);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .attr('width', xScale.bandwidth());</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 添加矩形内提示文字</span></span><br><span class="line"><span class="string">        chart.append('text')</span></span><br><span class="line"><span class="string">            .attr('class', 'barText')</span></span><br><span class="line"><span class="string">            .attr('x', function (d) &#123;</span></span><br><span class="line"><span class="string">                return xScale(d.key);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            //动画开始</span></span><br><span class="line"><span class="string">            .attr("</span>y<span class="string">", function (d) &#123;</span></span><br><span class="line"><span class="string">                var min = yScale.domain()[0];</span></span><br><span class="line"><span class="string">                return yScale(min);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .attr("</span>height<span class="string">", function (d) &#123;</span></span><br><span class="line"><span class="string">                return 0;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .transition()</span></span><br><span class="line"><span class="string">            .delay(function (d, i) &#123;</span></span><br><span class="line"><span class="string">                return i * 200;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .duration(1000)</span></span><br><span class="line"><span class="string">            .ease(d3.easeBounceIn)</span></span><br><span class="line"><span class="string">            //动画结束</span></span><br><span class="line"><span class="string">            .attr('y', function (d) &#123;</span></span><br><span class="line"><span class="string">                return yScale(d.value);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .attr('dx', xScale.bandwidth() / 2)</span></span><br><span class="line"><span class="string">            .attr('dy', 20)</span></span><br><span class="line"><span class="string">            .attr('text-anchor', 'middle')</span></span><br><span class="line"><span class="string">            .text(function (d) &#123;</span></span><br><span class="line"><span class="string">                console.log("</span>d.value<span class="string">", d.value)</span></span><br><span class="line"><span class="string">                return d.value;</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        // 添加hover事件</span></span><br><span class="line"><span class="string">        chart.on('mouseover', function (d) &#123;</span></span><br><span class="line"><span class="string">                d3.select(this).attr('opacity', 0.7);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">            .on('mouseout', function (d) &#123;</span></span><br><span class="line"><span class="string">                d3.select(this)</span></span><br><span class="line"><span class="string">                    .transition()</span></span><br><span class="line"><span class="string">                    .duration(500)</span></span><br><span class="line"><span class="string">                    .attr('opacity', 1)</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    const padding = &#123;</span></span><br><span class="line"><span class="string">        top: 50,</span></span><br><span class="line"><span class="string">        right: 20,</span></span><br><span class="line"><span class="string">        bottom: 30,</span></span><br><span class="line"><span class="string">        left: 30</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    const width = 760 - padding.left - padding.right;</span></span><br><span class="line"><span class="string">    const height = 380 - padding.top - padding.bottom;</span></span><br><span class="line"><span class="string">    const rectHeight = 25; //每个矩形所占的像素高度(包括空白)</span></span><br><span class="line"><span class="string">    const rectPadding = 4; //矩形之间的空白</span></span><br><span class="line"><span class="string">    var data = [&#123;</span></span><br><span class="line"><span class="string">            key: 'aa',</span></span><br><span class="line"><span class="string">            value: 32</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'bb',</span></span><br><span class="line"><span class="string">            value: 26</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'cc',</span></span><br><span class="line"><span class="string">            value: 45</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'dd',</span></span><br><span class="line"><span class="string">            value: 38</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'ee',</span></span><br><span class="line"><span class="string">            value: 53</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'ff',</span></span><br><span class="line"><span class="string">            value: 48</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'gg',</span></span><br><span class="line"><span class="string">            value: 42</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'hh',</span></span><br><span class="line"><span class="string">            value: 34</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'ii',</span></span><br><span class="line"><span class="string">            value: 37</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            key: 'jj',</span></span><br><span class="line"><span class="string">            value: 36</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    ]; //数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    BarInit(width, height, rectHeight, rectPadding, padding, data);</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2018/03/17/D3.js实现带动画效果的柱状图/" data-id="cjtvibb9n0009uovdyc2foogg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/D3-js/">D3.js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-魔改echarts生成类环形散点图，附带随机数据的组装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/14/魔改echarts生成类环形散点图，附带随机数据的组装/" class="article-date">
  <time datetime="2018-03-14T07:31:49.000Z" itemprop="datePublished">2018-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/14/魔改echarts生成类环形散点图，附带随机数据的组装/">魔改 Echarts 生成类环形散点图，附带随机数据的组装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们先看效果图，如下图所示：<img src="https://img-blog.csdnimg.cn/20181102144713619.gif" alt="在这里插入图片描述"><br>接下来是代码部分，首先准备一个容器：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-12 chart"</span> <span class="attr">id</span>=<span class="string">"backImage"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"monitor-rada"</span> <span class="attr">class</span>=<span class="string">"rada"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"monitor-info"</span> <span class="attr">class</span>=<span class="string">"scatter"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>容器需提供样式：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*背景图片就是上图中的由很多环组成的圆形背景*/</span></span><br><span class="line"> <span class="selector-id">#backImage</span> &#123;</span><br><span class="line">            <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'/static/image/back1.png'</span>) no-repeat center;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">345px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#monitor-rada</span> &#123;</span><br><span class="line">       <span class="attribute">height</span>: <span class="number">345px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*这里添加position是为了让雷达图和散点图两个canvas叠加*/</span></span><br><span class="line"><span class="selector-id">#monitor-info</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">345px</span>;</span><br><span class="line">            <span class="attribute">position</span>: relative;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">345px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来就是主要的js部分：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> infoChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'monitor-info'</span>), <span class="string">"macarons"</span>);</span><br><span class="line"><span class="keyword">var</span> radaChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'monitor-rada'</span>), <span class="string">"macarons"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******</span></span><br><span class="line"><span class="comment">     * @params : &#123;</span></span><br><span class="line"><span class="comment">     *      len: Its type must be number; It means the number of random numbers you want to get. ---necessary</span></span><br><span class="line"><span class="comment">     *      start: Its type must be number; It means the beginning of the range of random numbers you want to get.. ---necessary</span></span><br><span class="line"><span class="comment">     *      end: Its type must be number; It means the end of the range of random numbers you want to get. ---necessary</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * @returns : &#123;</span></span><br><span class="line"><span class="comment">     *      content: It will return an array of len non-repeating random numbers</span></span><br><span class="line"><span class="comment">     *      type:Array;</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * @example : &#123;</span></span><br><span class="line"><span class="comment">     *      radomNum(10, 20, 40);</span></span><br><span class="line"><span class="comment">     *      [ 28, 39, 20, 25, 32, 38, 26, 37, 34, 29 ]</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * @author:wananwen</span></span><br><span class="line"><span class="comment">     * @date: 1&gt; 2018.10.23 --- creat</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">randomNum</span>(<span class="params">len, start, end</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> arrNum = [];</span><br><span class="line">        <span class="keyword">var</span> difference = end - start;</span><br><span class="line">        <span class="keyword">while</span> (arrNum.length &lt; len) &#123;</span><br><span class="line">            <span class="keyword">var</span> randNum = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * difference + start);</span><br><span class="line">            <span class="keyword">if</span> (arrNum.indexOf(randNum) == <span class="number">-1</span>) &#123;</span><br><span class="line">                arrNum.push(randNum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arrNum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initInfoChart</span>(<span class="params"> </span>) </span>&#123;</span><br><span class="line">     <span class="comment">//散点图option</span></span><br><span class="line">  <span class="keyword">var</span> infoOption = &#123;</span><br><span class="line">      tooltip: &#123;</span><br><span class="line">                zlevel: <span class="number">2</span>,</span><br><span class="line">                z: <span class="number">10</span>,</span><br><span class="line">                trigger: <span class="string">'item'</span>,</span><br><span class="line">                formatter: <span class="function"><span class="keyword">function</span> (<span class="params">params, ticket, callback</span>) </span>&#123;</span><br><span class="line">                   <span class="keyword">var</span> data = params[<span class="number">2</span>][<span class="number">3</span>];</span><br><span class="line">                   <span class="keyword">var</span> ip = data.ip;</span><br><span class="line">                   <span class="keyword">var</span> status = data.status;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"此服务器IP为："</span> + ip + <span class="string">"&lt;br&gt;"</span> + <span class="string">"此服务器状态为："</span> + status</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                color: [<span class="string">'#F85A5B'</span>, <span class="string">'#FF7000'</span>, <span class="string">'#FDEA12'</span>, <span class="string">'#4060F3'</span>],</span><br><span class="line">                grid: &#123;</span><br><span class="line">                    show: <span class="string">'true'</span>,</span><br><span class="line">                    borderWidth: <span class="string">'0'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                legend: &#123;</span><br><span class="line">                    x: <span class="string">'right'</span>,</span><br><span class="line">                    y: <span class="string">'90%'</span>,</span><br><span class="line">                    itemWidth: <span class="number">10</span>,</span><br><span class="line">                    itemHeight: <span class="number">10</span>,</span><br><span class="line">                    data: [<span class="string">'正常'</span>, <span class="string">'低'</span>, <span class="string">'中'</span>, <span class="string">'高'</span>]</span><br><span class="line">                &#125;,</span><br><span class="line">                xAxis: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        type: <span class="string">'value'</span>,</span><br><span class="line">                        show: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                yAxis: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        type: <span class="string">'value'</span>,</span><br><span class="line">                        show: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                series: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: <span class="string">'正常'</span>,</span><br><span class="line">                        type: <span class="string">'scatter'</span>,</span><br><span class="line">                        itemStyle: &#123;</span><br><span class="line">                            normal: &#123;</span><br><span class="line">                                color: <span class="string">'#4060F3'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        symbolSize: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">Math</span>.round(value[<span class="number">2</span>] / <span class="number">5</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: <span class="string">'低'</span>,</span><br><span class="line">                        type: <span class="string">'scatter'</span>,</span><br><span class="line">                        itemStyle: &#123;</span><br><span class="line">                            normal: &#123;</span><br><span class="line">                                color: <span class="string">'#FDEA12'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        symbolSize: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">Math</span>.round(value[<span class="number">2</span>] / <span class="number">5</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, &#123;</span><br><span class="line">                        name: <span class="string">'中'</span>,</span><br><span class="line">                        type: <span class="string">'scatter'</span>,</span><br><span class="line">                        itemStyle: &#123;</span><br><span class="line">                            normal: &#123;</span><br><span class="line">                                color: <span class="string">'#FF7000'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        symbolSize: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">Math</span>.round(value[<span class="number">2</span>] / <span class="number">5</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: <span class="string">'高'</span>,</span><br><span class="line">                        type: <span class="string">'scatter'</span>,</span><br><span class="line">                        itemStyle: &#123;</span><br><span class="line">                            normal: &#123;</span><br><span class="line">                                color: <span class="string">'#F85A5B'</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        symbolSize: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">Math</span>.round(value[<span class="number">2</span>] / <span class="number">5</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: <span class="string">'range'</span>,</span><br><span class="line">                        type: <span class="string">'scatter'</span>,</span><br><span class="line">                        symbolSize: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;;</span><br><span class="line">    <span class="comment">//雷达图</span></span><br><span class="line">     <span class="keyword">var</span> radarOption = &#123;</span><br><span class="line">         calculable: <span class="literal">false</span>,</span><br><span class="line">          series: (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> series = [];</span><br><span class="line">                 <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">                    series.push(&#123;</span><br><span class="line">                        name: <span class="string">'雷达'</span>,</span><br><span class="line">                        type: <span class="string">'pie'</span>,</span><br><span class="line">                        radius: [i * <span class="number">4</span> + <span class="number">35</span>, i * <span class="number">4</span> + <span class="number">38</span>],</span><br><span class="line">                        data: []</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">               series[<span class="number">0</span>].markPoint = &#123;</span><br><span class="line">                   symbol: <span class="string">'emptyCircle'</span>,</span><br><span class="line">                   symbolSize: series[<span class="number">0</span>].radius[<span class="number">0</span>],</span><br><span class="line">                   effect: &#123;<span class="attr">show</span>: <span class="literal">true</span>, <span class="attr">scaleSize</span>: <span class="number">12</span>, <span class="attr">color</span>: <span class="string">'rgba(213,224,252,0.8)'</span>, <span class="attr">shadowBlur</span>: <span class="number">10</span>, <span class="attr">period</span>: <span class="number">40</span>&#125;,</span><br><span class="line">                   data: [&#123;<span class="attr">x</span>: <span class="string">'50%'</span>, <span class="attr">y</span>: <span class="string">'50%'</span>&#125;]</span><br><span class="line">                &#125;;</span><br><span class="line">              <span class="keyword">return</span> series;</span><br><span class="line">        &#125;)()</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//初始化后台传过来的数据</span></span><br><span class="line"> <span class="keyword">var</span> json = &#123;</span><br><span class="line">             <span class="string">'status'</span>: <span class="number">0</span>,</span><br><span class="line">             <span class="string">'code'</span>: <span class="number">0</span>,</span><br><span class="line">             <span class="string">'msg'</span>: <span class="string">'success'</span>,</span><br><span class="line">             <span class="string">'data'</span>: &#123;</span><br><span class="line">                      <span class="string">'normal'</span>: [&#123;<span class="attr">ip</span>: <span class="string">"192.168.10.36"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;, &#123;<span class="attr">ip</span>: <span class="string">"192.168.10.36"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;],</span><br><span class="line">                      <span class="string">'low'</span>: [&#123;<span class="attr">ip</span>: <span class="string">"192.168.22.2"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;, &#123;<span class="attr">ip</span>: <span class="string">"192.168.22.2"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;],</span><br><span class="line">                     <span class="string">'middle'</span>: [&#123;<span class="attr">ip</span>: <span class="string">"192.168.10.36"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;, &#123;<span class="attr">ip</span>: <span class="string">"192.168.10.36"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;],</span><br><span class="line">                     <span class="string">'high'</span>: [&#123;<span class="attr">ip</span>: <span class="string">"192.168.22.2"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;, &#123;<span class="attr">ip</span>: <span class="string">"192.168.22.2"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;]</span><br><span class="line">             &#125;</span><br><span class="line">&#125;;</span><br><span class="line">                    </span><br><span class="line"> <span class="comment">//随机数据组装(确保散点分布在背景图周围)</span></span><br><span class="line"><span class="keyword">var</span> totalLen = json.data.normal.length + json.data.low.length + json.data.middle.length + json.data.high.length;</span><br><span class="line"><span class="keyword">var</span> randomArr = dataHandle.randomNum(totalLen, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line"><span class="keyword">var</span> useArr = [];</span><br><span class="line"><span class="comment">// 动态分配随机数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scatterDataInit</span>(<span class="params">sourceData</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> arr = [];</span><br><span class="line">      <span class="keyword">var</span> len = sourceData.length;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; randomArr.length; i++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (arr.length &lt; len) &#123;</span><br><span class="line">               <span class="keyword">if</span> (randomArr.indexOf(useArr[i]) == <span class="number">-1</span>) &#123;</span><br><span class="line">                    arr.push(randomArr[i]);</span><br><span class="line">                     useArr.push(randomArr[i]);</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                          <span class="keyword">continue</span>;</span><br><span class="line">                          &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> totalData = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">         <span class="keyword">var</span> msgData = [];</span><br><span class="line">         msgData.push(sourceData[j]);</span><br><span class="line">         msgData.unshift(arr[j], dataHandle.randomNum(<span class="number">1</span>, <span class="number">0</span>, <span class="number">40</span>)[<span class="number">0</span>],  dataHandle.randomNum(<span class="number">1</span>, <span class="number">20</span>, <span class="number">50</span>)[<span class="number">0</span>]);</span><br><span class="line">          totalData.push(msgData)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalData;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//生成一个假点，以便echarts散点图能够有一个确定的阈值。</span></span><br><span class="line"> <span class="keyword">var</span> maxRangePoint = [[<span class="number">60</span>, <span class="number">40</span>, <span class="number">30</span>, &#123;<span class="attr">ip</span>: <span class="string">"192.168.10.36"</span>, <span class="attr">status</span>: <span class="string">"ok"</span>&#125;]];</span><br><span class="line">                            </span><br><span class="line"> infoOption.series[<span class="number">0</span>].data = scatterDataInit(json.data.normal);</span><br><span class="line"> infoOption.series[<span class="number">1</span>].data = scatterDataInit(json.data.low);</span><br><span class="line"> infoOption.series[<span class="number">2</span>].data = scatterDataInit(json.data.middle);</span><br><span class="line"> infoOption.series[<span class="number">3</span>].data = scatterDataInit(json.data.high);</span><br><span class="line"> infoOption.series[<span class="number">4</span>].data = maxRangePoint;</span><br><span class="line"> <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span><br><span class="line"> radaChart.setOption(radarOption);</span><br><span class="line"> infoChart.setOption(infoOption);</span><br><span class="line">&#125;</span><br><span class="line">initInfoChart();</span><br></pre></td></tr></table></figure></p>
<p>以上就是全部代码了，主要就是处理随机数据的生成，和将随机数据动态分配给后台数据，并组装成echarts散点图可执行的数据格式。如果有疑问，欢迎在底下留言。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2018/03/14/魔改echarts生成类环形散点图，附带随机数据的组装/" data-id="cjtvibbcn000iuovdv5l1pvqg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Echarts/">Echarts</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-从JavaScript的垃圾回收机制谈起" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/11/从JavaScript的垃圾回收机制谈起/" class="article-date">
  <time datetime="2018-03-11T13:19:23.000Z" itemprop="datePublished">2018-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/11/从JavaScript的垃圾回收机制谈起/">从 JavaScript 的垃圾回收机制谈起</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>JavaScript 垃圾回收机制大家肯定都有所了解。网上大部分的文章也都是在讲引用计数算法和垃圾回收算法的原理以及这两者之间的区别。今天咱们不提这个，咱们只提关于老垃圾回收算法和新垃圾回收算法的演变。</p>
<h2 id="一-旧的-JavaScript-垃圾回收算法："><a href="#一-旧的-JavaScript-垃圾回收算法：" class="headerlink" title="一.旧的 JavaScript 垃圾回收算法："></a>一.旧的 JavaScript 垃圾回收算法：</h2><p>我们以 V8 引擎为划分线。V8 之前的浏览器的垃圾回收算法大概有三类：</p>
<blockquote>
<p>1.引用计数（Reference Counting）算法（低版本ie下使用）<br>2.标记-清除（Mark-Sweep）算法<br>3.复制（copying）算法</p>
</blockquote>
<p>我们先谈谈引用计数算法。顾名思义，引用计数算法的原理就是跟踪记录每个值被引用的次数。当声明一个变量将一个引用类型赋值给该变量时该值引用次数加 1，当这个变量指向另一个时该值的引用次数便减一。当该值引用次数为0时就会被回收。它的缺点简单提提，循环引用时会引发内存泄露。<br>再谈谈标记-清除算法。当变量进入执行环境的时候，比如函数中声明一个变量，垃圾回收器将其标记为“进入环境”，当变量离开环境的时候（函数执行结束）将其标记为“离开环境”。它的缺点是会产生小的内存碎片，而小的内存碎片再未来有大内存空间需要分配时是无法被利用的。<br>最后谈谈复制算法。此算法的出现是为了解决标记清除算法效率低下的问题，我们来看看原理。首先，此算法会将内存空间分为两部分，我们假设为 A 区域和 B 区域。先将所有的对象放置到 A 区中，在开始进行垃圾回收时，把 A 区中还需要留下来下次使用的对象转移到B区，然后将 A 区中剩余的对象清空，最后再将B区的对象转移到A区，以此类推。此算法效率奇高，但是要闲置一半的内存空间，实在是让人难以接受。</p>
<h2 id="二-V8新生代垃圾回收算法："><a href="#二-V8新生代垃圾回收算法：" class="headerlink" title="二.V8新生代垃圾回收算法："></a>二.V8新生代垃圾回收算法：</h2><p>V8 的 GC 回收算法主要是将内存空间划分为了新生代和老生代，新生代主要采用 Scavenge 算法,而 Scavenge 算法是基于 Cheney 算法实现的（Cheney 算法就是基于上面我说 copying 算法）；老生代采用的是 Mark-Sweep&amp;Mark-Compact 算法。</p>
<blockquote>
<p>1.新生代：Scavenge算法-Cheney算法.<br>2.老生代：Mark-Sweep&amp;Mark-Compact算法.</p>
</blockquote>
<p>我们先谈谈新生代里垃圾回收机制是怎么运行的。由于它是基于copying算法，那么原理就很显然了，它将新生代所占据的内存空间分成两部分 FORM 和 TO，当垃圾回收开始时，来检查 A 区中的存活对象，然后将这些存货对象移入 TO 区中，再释放 FORM 区的内存。最后将 FORM，TO 对调。</p>
<p>Scavenge 算法通过牺牲空间换时间的算法非常适合生命周期短的新生代，但是，当一个对象经过多次复制，生命周期较长的时候或则B空间不足的时候，对象会被分配到进入到老生代中，并采用新的算法进行垃圾回收。</p>
<p>那么老生代是如何运行的呢？<br>Mark-Sweep 算法会在垃圾回收时遍历老生代空间中所有的存活对象，并标记他们。然后清除掉没有被标记的对象。而 Mark-Compact 则是用来处理标记清除后存在的内存碎片问题。它会将活着的对象往内存空间的一端移动，移动完成后直接清除边界外的内存，以此完成对碎片的回收。</p>
<p>除此之外还需要补充的一点是，对象晋升。其实就是新生代对象晋升到老生代对象的过程。<br>对象晋升主要发生在FORM空间复制对象到TO空间时期，在这期间主要有两个判断条件：</p>
<blockquote>
<p>1.是否已经经历过Scavenge回收<br>2.TO空间的内存占用比是否超过25%</p>
</blockquote>
<p>满足其中任意一个条件此对象就会晋升到老生代空间中</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2018/03/11/从JavaScript的垃圾回收机制谈起/" data-id="cjtvibbc4000huovdshhsrkx2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JavaScript 中神奇的加法（隐式类型转换）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/02/JavaScript 中神奇的加法（隐式类型转换）/" class="article-date">
  <time datetime="2018-03-02T01:12:20.000Z" itemprop="datePublished">2018-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/02/JavaScript 中神奇的加法（隐式类型转换）/">JavaScript 中神奇的加法（隐式类型转换）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一般来说， 加减法应该是我们学习生涯中接触到的第一个运算符，通常意义下它也是最简单的运算符。</p>
<p>在程序语言中，加减法的情况一般也比较简单，但是在 JavaScript 中加法的情况却比较奇怪，因为它有着大量特殊的情况。</p>
<p>我们举个简单的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="string">'1'</span> = <span class="string">'11'</span>; </span><br><span class="line"><span class="number">1</span> + <span class="string">'a'</span> = <span class="string">'1a'</span>;</span><br><span class="line"><span class="number">1</span> + []  = <span class="string">''</span>;</span><br></pre></td></tr></table></figure></p>
<p>从基础数据类型的加法开始，我们得到的结果就变的奇怪了起来。究其根由，其实是 JavaScript 的隐式转换在做怪。</p>
<h2 id="一-什么是-JavaScript-隐式转换"><a href="#一-什么是-JavaScript-隐式转换" class="headerlink" title="一.什么是 JavaScript 隐式转换?"></a>一.什么是 JavaScript 隐式转换?</h2><p>在讲隐式转换之前，咱们先得回顾一下 <strong>JavaScript</strong> 的 <strong>5</strong> 种基础数据类型,<strong>3</strong>种引用数据类型和 <strong>3</strong> 个特殊值：</p>
<p><strong>基础数据类型：</strong></p>
<ol>
<li>number 类型</li>
<li>string 类型</li>
<li>boolean 类型</li>
<li>null 类型</li>
<li>undefined 类型</li>
</ol>
<p><strong>引用数据类型：</strong></p>
<ol>
<li>object</li>
<li>function</li>
<li>array</li>
</ol>
<p><strong>特殊值:</strong></p>
<ol>
<li>NaN</li>
<li>+Infinity 和 -Infinity</li>
<li>+0 和 -0</li>
</ol>
<p>ok，我们回到隐式转换中，正如我开始举的那个例子一样，<strong>JavaScript</strong> 的隐式转换总是发生在各种运算符以及特殊的真值判断中(比如说 if),对与 <strong>java</strong> 来说，一个 <strong>Number</strong> 类型值 <strong>+</strong> 一个 <strong>Boolean</strong> 类型值 是肯定会报错的，但是在 <strong>JavaScript 中却不会</strong>，因为隐式转换会将 <strong>Boolean</strong>     类型的值转换为 <strong>Number</strong> 值。</p>
<h2 id="二-JavaScript-的加法中隐式转换是怎么工作的？"><a href="#二-JavaScript-的加法中隐式转换是怎么工作的？" class="headerlink" title="二. JavaScript 的加法中隐式转换是怎么工作的？"></a>二. JavaScript 的加法中隐式转换是怎么工作的？</h2><p>你在百度上搜索 JavaScript 加法特性，你也许会看到这种图解：<br><img src="https://img-blog.csdnimg.cn/20190118094233741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>或者是这种：<br><img src="https://img-blog.csdnimg.cn/20190118094301683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>他们是很有用处的内容总结，但是光靠它们并不能帮我们更好的去理解，所以我们需要实例来支撑理论。</p>
<p>我们先来看看一个有趣的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// number + ?</span></span><br><span class="line"><span class="number">1</span> + <span class="number">1</span> = <span class="number">2</span>;  <span class="comment">// number</span></span><br><span class="line"><span class="number">1</span> + <span class="string">'1'</span> = <span class="string">"11"</span>;  <span class="comment">// string</span></span><br><span class="line"><span class="number">1</span> + <span class="literal">true</span> = <span class="number">2</span>; <span class="comment">// number</span></span><br><span class="line"><span class="number">1</span> + <span class="literal">null</span> =  <span class="number">1</span>; <span class="comment">//number</span></span><br><span class="line"><span class="number">1</span> + <span class="literal">undefined</span> = <span class="literal">NaN</span>  <span class="comment">// NaN</span></span><br><span class="line"><span class="number">1</span> + &#123;&#125; = <span class="string">"1[object Object]"</span>  <span class="comment">// string</span></span><br><span class="line"><span class="number">1</span> + [] = <span class="string">"1"</span>;  <span class="comment">// string </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// string + ?</span></span><br><span class="line"><span class="string">'1'</span> + <span class="number">1</span> = <span class="string">"11"</span>;  <span class="comment">// string</span></span><br><span class="line"><span class="string">'1'</span> + <span class="string">'1'</span> = <span class="string">"11"</span>;   <span class="comment">// string</span></span><br><span class="line"><span class="string">'1'</span> + <span class="literal">true</span> = <span class="string">"1true"</span>;   <span class="comment">// string</span></span><br><span class="line"><span class="string">'1'</span> + <span class="literal">null</span> = <span class="string">"1null"</span>;   <span class="comment">// string</span></span><br><span class="line"><span class="string">'1'</span> + <span class="literal">undefined</span> = <span class="string">"1undefined"</span>;   <span class="comment">// string</span></span><br><span class="line"><span class="string">'1'</span> + &#123;&#125; = <span class="string">"1[object object]"</span>;   <span class="comment">// string</span></span><br><span class="line"><span class="string">'1'</span> + [] = <span class="string">"1"</span>;  <span class="comment">// string</span></span><br></pre></td></tr></table></figure></p>
<p>看到这大家是不是有点晕？我之所以举了这两个例子，是因为在 JavaScript 的加法中其实只有两种规则：<strong>一种是 number + number</strong>,<strong>另一种是 string + string</strong>。</p>
<p>我们从 <code>string +　？</code>的例子中很容易的可以得出一个结论，<strong>只要在某一个加法中，某一方是字符串，那么最后的结果一定是字符串。</strong></p>
<p>但是这个结论只能解决我们很小的一部分疑惑，你可能存在类似下面的问题：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">number + boolean = ?</span><br><span class="line">number + <span class="literal">null</span> = ?</span><br><span class="line">number + <span class="literal">undefined</span> = ?</span><br><span class="line">number + object = ?</span><br></pre></td></tr></table></figure></p>
<p>我觉得，想要理解这其中的转换，先得理解的是在一个加法运算中，隐式转换的潜规则到底是什么。</p>
<p>首先，在 JavaScript 的加法中，会发生三种转换：</p>
<p> **1. 原始类型转换 ToPrimitive</p>
<ol start="2">
<li>数字类型转换 ToNumber</li>
<li>字符串类型转换 ToString**</li>
</ol>
<p>而转换的顺序永远是 <code>ToPrimitive</code>也就是原始类型转换优先。</p>
<p>那么什么是 <strong>原始类型转换</strong>？</p>
<p>我们可以把原始类型转换分为两种，第一种是简单基本类型之间互转，比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">number -&gt; string</span><br><span class="line">string -&gt; number</span><br><span class="line"><span class="literal">null</span> -&gt; number</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>这其中的转换没什么要注意的地方，大家把我在上面借用过来的图里的内容记下来就行。</p>
<p>关键点在于第二种，复杂基本类型到简单基本类型的转换：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">object -&gt; number</span><br><span class="line">object -&gt; string</span><br><span class="line"></span><br><span class="line">array -&gt; number</span><br><span class="line">array -&gt; string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> -&gt; <span class="title">number</span></span></span><br><span class="line"><span class="function"><span class="title">function</span> -&gt; <span class="title">string</span></span></span><br></pre></td></tr></table></figure></p>
<p>okok,有了上面的基础，我们再来讲讲原始类型转换的工作原理，老规矩，我们打开ECMAScript的官网<a href="http://www.ecma-international.org/ecma-262/5.1/" target="_blank" rel="noopener">ecmascript 5.1规范</a>，找到 9.1 节，里面就有关于 ~ToPrimitive</p>
<p>我给大家放下原版内容：<br><img src="https://img-blog.csdnimg.cn/20190118094438440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>大概解释如下</strong>：<br><code>ToPrimitive</code> 接受一个值 <code>input</code>，和一个可选的期望类型 <code>PreferredType</code> 作参数。<br>可选参数 <code>PreferredType</code> 可以是 <code>Number</code> 或者 <code>String</code>。</p>
<p>如果对象有能力被转换为不止一种原语类型，可以使用可选的 PreferredType 类型 来<strong>暗示</strong>那个类型，但转换结果一定是一个原始值。</p>
<p><strong>如果 PreferredType 被标志为 Number，则会进行下面的操作来转换input:</strong></p>
<ol>
<li>如果 input 是个原始值，则直接返回它。 否则，如果 input 是一个对象。则调用 obj.valueOf() 方法。</li>
<li>如果返回值是一个原始值，则返回这个原始值。 否则，调用 obj.toString() 方法。 如果返回值是一个原始值，则返回这个原始值。</li>
<li>否则，抛出 TypeError异常。如果PreferredType被标志为String，则转换操作的第二步和第三步的顺序会调换。</li>
</ol>
<p><strong>如果没有 PreferredType 这个参数，则PreferredType的值会按照这样的规则来自动设置：</strong></p>
<ol>
<li>Date 类型的对象会被设置为 String</li>
<li>其它类型的值会被设置为 Number</li>
</ol>
<p>OK,现在我们知道了 原始数据类型转换的大致工作流程，我们来看看在一个 加法 中会发生什么？</p>
<p>有两个参数 <code>value1</code> 和 <code>value2</code>,有以下算式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value1 + value2</span><br></pre></td></tr></table></figure></p>
<p><strong>这时在 JavaScript 引擎内部会发生以下这三步：</strong></p>
<ol>
<li>通过 <code>ToPrimitive</code> 将 <code>value1</code> 和 <code>value2</code> 转化为原始值，此时 <code>PreferredType</code>参数是被忽略的，所以除了 Date 类型外其他类型都会按照 Number 参数来处理。</li>
<li>此时如果 <code>value1</code> 和 <code>value2</code> 中有一个 <code>string</code> 类型，调用 <code>ToString</code> 方法将另一个参数转化为 <code>string</code> 类型并进行字符串的拼接。</li>
<li>如果 <code>value1</code> 和 <code>value2</code> 中一个 <code>string</code> 类型都没有，那么则通过 <code>ToNumber</code> 方法将两个参数都转化为 <code>number</code> 类型。</li>
</ol>
<p>我举几个例子帮助大家理解下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + <span class="string">'2'</span> = <span class="string">'12'</span> ;</span><br></pre></td></tr></table></figure></p>
<p>1被 <code>ToPrimitive</code> 返回其自身的原始值 <code>number</code>， ‘2’的原始值为  <code>string</code> ，命中条件2，所以1被 <code>ToString</code> 转化为 ‘1’, ‘1’ 与 ‘2’ 进行拼接后得到 ‘12’;</p>
<p>再看一个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + [] = <span class="string">'1'</span>;</span><br></pre></td></tr></table></figure></p>
<p>1被 <code>ToPrimitive</code> 返回其自身的原始值 <code>number</code>， [] 则不太一样，首先它会调用 valueOf()函数<code>[].valueOf() === []</code>得到 <code>array</code>,这并不是原始值，所以它会进行 <code>toString()</code> 转换，得到空字符串 <code>&quot;&quot;</code>。然后<code>&quot;&quot;</code>与 1 相加显然就是拼接了，最终得到<code>&#39;1&#39;</code>;</p>
<p>再来一个：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + &#123;&#125; = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>1被 <code>ToPrimitive</code> 返回其自身的原始值 <code>number</code>，{} 与 [] 又不太一样，{} 为对象，它会进行<code>ToPrimitive({}, string)</code> 操作，此时它与 <code>Number</code>类型中的步骤2,3是相反的，也就是说它会直接调用 <code>toString()</code> 方法，得到 <code>&quot;[object object]&quot;</code>,类型为 <code>string</code>,此时又命中条件2,1被转化为<code>&#39;1&#39;</code>,进行字符串拼接后得到<code>&quot;1[object object]&quot;</code>。</p>
<p>现在是不是清晰多了？整个工作原理，我们可以把它分为三部分：<br><strong>1.简单基本类型之间的转化规则：</strong></p>
<p><strong>2.原始基本类型的转化原则。<br>3.加法中的执行顺序。</strong></p>
<h2 id="三-害人的的语句优先"><a href="#三-害人的的语句优先" class="headerlink" title="三. 害人的的语句优先"></a>三. 害人的的语句优先</h2><p>有这么一种情况，会让人疑惑：<br>在浏览器控制台输入以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; + <span class="number">1</span>   <span class="comment">//  return 1 number;</span></span><br><span class="line"><span class="number">1</span> + &#123;&#125;   <span class="comment">//return '1[object object]' string</span></span><br></pre></td></tr></table></figure></p>
<p>如图：<br><img src="https://img-blog.csdnimg.cn/20190118094456545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>还有更让人疑惑的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; + <span class="number">1</span>  <span class="comment">//  return 1 number;</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125; + <span class="number">1</span>)  <span class="comment">//  logs '1[object object]' string</span></span><br></pre></td></tr></table></figure></p>
<p>如图：<br><img src="https://img-blog.csdnimg.cn/20190118094506945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>这一切的根源就在于 <code>{}</code>的特殊表现，实际上在 JavaScript 的执行上下文中，<code>{}</code>有以下三种含义：</p>
<ol>
<li>语句块</li>
<li>函数</li>
<li>对象字面量</li>
</ol>
<p>而其中 <strong>语句块</strong> 这个含义的<strong>优先级是最高的</strong>。</p>
<p>所以，以下这段代码中的<code>{}</code>相当于全局环境中的 <code>label</code> 语句了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; + <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>实际上等于：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;;+<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>即：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+<span class="number">1</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2018/03/02/JavaScript 中神奇的加法（隐式类型转换）/" data-id="cjtvibbb6000fuovduxb0a37z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-TopTal 进阶 JavaScript 面试题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/13/TopTal 进阶 JavaScript 面试题/" class="article-date">
  <time datetime="2018-02-13T09:20:30.000Z" itemprop="datePublished">2018-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/13/TopTal 进阶 JavaScript 面试题/">TopTal 进阶 JavaScript 面试题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原网址：<a href="https://www.toptal.com/javascript/interview-questions" target="_blank" rel="noopener">37 Essential JavaScript Interview Questions </a></p>
<p>以下为我对这37个题目的翻译和解答，其中小部分题目的解答是我认为官方解答的很合适，也无需更为深入的挖掘，会直接翻译官方的回答；大部分题目的解答都是我对题中涉及到的知识点更深入的挖掘做出的解释。</p>
<hr>

<h2 id="1-当你使用typeof-bar-39-object-39-来确定-bar-是否是-object-时，这其中存在潜在问题是什么？如何规避这些问题？"><a href="#1-当你使用typeof-bar-39-object-39-来确定-bar-是否是-object-时，这其中存在潜在问题是什么？如何规避这些问题？" class="headerlink" title="1.当你使用typeof bar === &#39;object&#39; 来确定 bar 是否是 object 时，这其中存在潜在问题是什么？如何规避这些问题？"></a>1.当你使用<code>typeof bar === &#39;object&#39;</code> 来确定 <code>bar</code> 是否是 object 时，这其中存在潜在问题是什么？如何规避这些问题？</h2><p>通常情况下，使用 <code>typeof</code> 来判断某个变量的类型，是没有什么问题的，但是如果你有一些特殊的需求，可能就会存在潜在问题了。</p>
<p>我们举个例子，你有个变量 <code>a</code>，需要做类型校验，如果是 <code>object</code> 类型就 <code>true</code>,程序继续往下走，此时，我们希望出现的结果是什么？是这个 <code>a</code> 变量不为空，且有价值数据，这个数据是一个 <code>object</code> 类型的对象，我们希望拿到这个对象数据来进行某些处理。</p>
<p>那么此时由于一些未知的原因，你没有拿到预期的数据，你拿到了一个 <code>null</code> ,此时你当然是希望你的判断条件不会命中它，因为一旦命中 <code>null</code> 的话，我们处理数据的逻辑部分很可能就会出现些不可预知的 bug 。</p>
<p>但是事实呢？很不幸的告诉你，它通过了你的判断条件，<code>typeof null === &#39;object&#39;</code> 会打印出 <code>true</code> 这一结果。</p>
<p>我们在这并不想深究为什么在javascript中<code>null</code>会是一个object对象,正如同我们并不想深究<code>NaN</code>为什么是一个 <code>number</code> 类型，而 <code>undeifined</code> 是一个 <code>undeifined</code> 类型一样，我们希望可以让你知道如何去分辨和规避，而不是告诉你为什么为什么 <code>null</code> 是一个 <code>object</code> 。</p>
<p>言归正传，在上述示例中，还有一个特殊的情况，比如说，<code>Array</code>。<code>typeof [] ===     &#39;object&#39;</code> 这句代码在 <code>JavaScript</code> 中是成立的，如果你想真正区分 <code>object</code> 和 <code>Array</code> ,那么你可以像下面这样修改你的命中条件：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(a) === <span class="string">'[object Array]'</span>)&#123;</span><br><span class="line">    <span class="comment">//     do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>或者还可以这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(a != <span class="literal">null</span> &amp;&amp; a.constructor === <span class="built_in">Object</span>)&#123;</span><br><span class="line">    <span class="comment">//     do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然，用ES5的 <code>isArray()</code> 也是可以的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">Array</span>.isArray(a))&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>要注意，<code>a.constructor</code> 并不是一个通用的解决方案，比如有以下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="literal">null</span>;</span><br><span class="line">b.constructor === <span class="built_in">Object</span>   <span class="comment">// Uncaught TypeError: Cannot read property 'constructor' of null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="literal">undefined</span>;</span><br><span class="line">b.constructor === Undeifined <span class="comment">// Uncaught TypeError: Cannot read property 'constructor' of undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="literal">NaN</span>;</span><br><span class="line">b.constructor === <span class="built_in">Number</span>;   <span class="comment">// logs true</span></span><br></pre></td></tr></table></figure></p>
<p><hr></p>
<h2 id="2-以下的代码会输出什么？为什么呢？"><a href="#2-以下的代码会输出什么？为什么呢？" class="headerlink" title="2.以下的代码会输出什么？为什么呢？"></a>2.以下的代码会输出什么？为什么呢？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = b = <span class="number">3</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a defined? "</span> + (<span class="keyword">typeof</span> a !== <span class="string">'undefined'</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b defined? "</span> + (<span class="keyword">typeof</span> b !== <span class="string">'undefined'</span>));</span><br></pre></td></tr></table></figure>
<p>这个问题有趣的地方在于你对 javascript 的关键字声明是否熟悉。你也许认为以下的输出是对的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"a defined? "</span>   <span class="literal">false</span></span><br><span class="line"><span class="string">"b defined? "</span>   <span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<p>但事实上很多人把 <code>var a=b=3</code> 当成了以下这种形式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">3</span>;</span><br></pre></td></tr></table></figure></p>
<p>但是事实上，<code>var a=b=3</code> 应该是这样的:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">var</span> a = b;</span><br></pre></td></tr></table></figure></p>
<p>如果你使用了严格模式(<code>use strict</code>),就没有这个困扰了，因为在运行时会报以下错误：<code>ReferenceError: b is not defined</code>.</p>
<p>所以，正确的输出应该如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"a defined? "</span>   <span class="literal">false</span></span><br><span class="line"><span class="string">"b defined? "</span>   <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<hr>

<h2 id="3-以下的代码块会输出什么内容？为什么？"><a href="#3-以下的代码块会输出什么内容？为什么？" class="headerlink" title="3.以下的代码块会输出什么内容？为什么？"></a>3.以下的代码块会输出什么内容？为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myObject = &#123;</span><br><span class="line">    foo: <span class="string">"bar"</span>,</span><br><span class="line">    func: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"outer func1:  this.foo = "</span> + <span class="keyword">this</span>.foo);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"outer func2:  self.foo = "</span> + self.foo);</span><br><span class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"inner func1:  this.foo = "</span> + <span class="keyword">this</span>.foo);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"inner func2:  self.foo = "</span> + self.foo);</span><br><span class="line">        &#125;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">myObject.func();</span><br></pre></td></tr></table></figure>
<p>这是一个典型的 <code>JavaScript</code> 指向的问题，对此有疑惑的可以去看看我的一篇专门解释 this 指向的文章：<a href="https://blog.csdn.net/dk2290/article/details/82587118" target="_blank" rel="noopener">javascript this探究</a></p>
<p>这儿我就简单解释下这其中的原理，首先正确的输出结果应该是如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">outer func1:  <span class="keyword">this</span>.foo = <span class="string">'bar'</span>,</span><br><span class="line">outer func2:  <span class="keyword">this</span>.foo = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">inner func1:  <span class="keyword">this</span>.foo = <span class="literal">undefined</span>,</span><br><span class="line">inner func2:  self.foo = <span class="string">'bar'</span></span><br></pre></td></tr></table></figure></p>
<p><strong>要想找到 this 的指向，只要找到这个 this 的(直接调用者)上一级调用者就ok了</strong>。在上述代码中，这个this（self）出在 func 函数内，也就是说，此 <code>this</code> 与 <code>func</code> 的地位是相等的，而 <code>func</code> 又由 <code>myObject</code> 这个对象调用，所以 outer 中 this 指向的就是 <code>myObject</code> 对象。</p>
<p>而在 <code>inner</code> 函数中的 <code>this</code> 是与这个匿名函数同级的，而这个匿名函数被 <code>func</code> 函数调用，它的上一级调用者就是 <code>func</code>函数,所以this自然就是 <code>undefined</code> 了，而此匿名函数又处在 <code>func</code>函数的作用域范围内，所以调用 <code>self</code> 变量时还是能拿到 <code>bar</code> 值;</p>
<hr>

<h2 id="4-将-JavaScript-源文件的整个内容包在闭包中的意义和原因是什么？"><a href="#4-将-JavaScript-源文件的整个内容包在闭包中的意义和原因是什么？" class="headerlink" title="4.将 JavaScript 源文件的整个内容包在闭包中的意义和原因是什么？"></a>4.将 JavaScript 源文件的整个内容包在闭包中的意义和原因是什么？</h2><p>这是一种越来越普遍的做法，被许多流行的 <code>JavaScript</code> 库（jQuery，Node.js等）采用。这种技术围绕文件的整个内容创建一个闭包，最重要的是，它可以创建一个私有命名空间，从而有助于避免不同 <code>JavaScript</code> 模块和库之间潜在的名称冲突。</p>
<p>该技术的另一个特征是允许使用更易于引用（可能更短）的全局变量的别名。例如，在 jQuery 插件中经常使用它。如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* jQuery plugin code referencing $ */</span> </span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure></p>
<p><hr></p>
<h2 id="5-use-strict在-JavaScript-源文件的开头包含什么是重要的，有什么好处？"><a href="#5-use-strict在-JavaScript-源文件的开头包含什么是重要的，有什么好处？" class="headerlink" title="5.use strict在 JavaScript 源文件的开头包含什么是重要的，有什么好处？"></a>5.<code>use strict</code>在 JavaScript 源文件的开头包含什么是重要的，有什么好处？</h2><p>简单来说，<code>use strict</code> 是一种在代码运行时自动对 <code>JavaScript</code> 代码实施更严格的解析和错误处理的方法。在未使用 <code>use strict</code> 时会被忽略或会以静默方式失败的代码，错误在使用了 <code>use strict</code> 现在将生成错误或抛出异常,光从这个角度来说，这就是一个很好的办法。</p>
<p><strong>严格模式的一些主要好处包括：</strong></p>
<p>1.<strong>使调试更容易</strong>。<br>否则将被忽略或将以静默方式失败的代码错误现在将生成错误或抛出异常，提前警告您代码中的问题并将您更快地引导到其源代码。<br>防止偶然的全局变量。如果没有严格模式，则为未声明的变量赋值会自动创建具有该名称的全局变量。这是 <code>JavaScript</code> 中最常见的错误之一。在严格模式下，尝试这样做会引发错误。</p>
<p>2.<strong>消除this胁迫</strong>。<br>如果没有严格模式，则 <code>this</code> 对 <code>null</code> 或 <code>undefined</code> 值的引用会自动强制转换为全局。这可能导致许多头屑和拔出你的头发类型的错误。在严格模式下，引用 <code>this</code>, <code>null</code> 或 <code>undefined</code>值会引发错误。</p>
<p>3.<strong>禁止重复的参数值</strong>。 严格模式在检测到函数的重复命名参数时会抛出错误（例如，<code>function foo(val1, val2, val1){}）</code>，从而捕获代码中几乎可以肯定的错误，否则您可能会浪费大量时间进行跟踪。<br>注意：以前（在 ECMAScript 5中）严格模式将禁止重复的属性名称（例如<code>var object = {foo: &quot;bar&quot;, foo: &quot;baz&quot;};）</code>，但从 ECMAScript 2015 开始，情况不再如此。</p>
<p>4.<strong>使eval（）更安全</strong>。<br>eval() 在严格模式和非严格模式下的行为 方式存在一些差异。最重要的是，在严格模式下，声明内部 eval() 声明的变量和函数不会在包含范围中创建（它们是在非严格模式的包含范围中创建的，这也可能是常见的问题来源）。</p>
<p>5.<strong>无效使用时会引发错误delete</strong>。<br>delete 操作者（用于从对象中删除属性）不能在对象的非配置的属性来使用。当尝试删除不可配置的属性时，非严格代码将无提示失败，而严格模式将在这种情况下抛出错误。</p>
<hr>

<h2 id="6-以下两个函数都会返回相同的内容吗？为什么？"><a href="#6-以下两个函数都会返回相同的内容吗？为什么？" class="headerlink" title="6.以下两个函数都会返回相同的内容吗？为什么？"></a>6.以下两个函数都会返回相同的内容吗？为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">      bar: <span class="string">"hello"</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">  &#123;</span><br><span class="line">      bar: <span class="string">"hello"</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在执行这两个函数的时候，会发现一件让人惊讶的事：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"foo1 returns:"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo1());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"foo2 returns:"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo2());</span><br></pre></td></tr></table></figure></p>
<p>会有以下结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foo1 returns:</span><br><span class="line"><span class="built_in">Object</span> &#123;<span class="attr">bar</span>: <span class="string">"hello"</span>&#125;</span><br><span class="line"><span class="string">'foo2 returns:'</span></span><br><span class="line"><span class="literal">undefined</span></span><br></pre></td></tr></table></figure></p>
<p>主要原因就是 <code>return</code> 后面的对象符 <code>}</code> 换行了。浏览器 <code>JavaScript</code> 引擎在解析时，会自动在换行的部分插入分号；，所以上述代码中的 <code>foo2()</code> 函数就如同下面：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那返回的自然就是一个 <code>undefined</code> 了。</p>
<hr>

<h2 id="7-什么是-NaN-如何用一个可靠的方法来判断它？"><a href="#7-什么是-NaN-如何用一个可靠的方法来判断它？" class="headerlink" title="7.什么是 NaN?如何用一个可靠的方法来判断它？"></a>7.什么是 NaN?如何用一个可靠的方法来判断它？</h2><p><code>NaN</code> 是一个全局属性，表示不是一个数字( Not a Number )。<br>通常来说，<code>NaN</code> 很少在编码中出现，它一般都是被某个方法计算错误时作为返回值给我们。<br><code>NaN</code> 有着一些很奇怪的特性：</p>
<p><strong>1.NaN 和任何值都不相等</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">NaN</span> === <span class="literal">NaN</span>)  <span class="comment">// logs false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">NaN</span> === <span class="number">1</span>)   <span class="comment">// logs false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">NaN</span> === <span class="string">'1'</span>)   <span class="comment">// logs false</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2.NaN 的数据类型为 number</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">NaN</span>)  <span class="comment">// logs number</span></span><br></pre></td></tr></table></figure></p>
<p><code>JavaScript</code>提供了一个内置的函数 <code>isNaN()</code> 来判断 <code>NaN</code>,它的作用机制是检查一个值是否能被 <code>Number()</code> 成功转换。如果能转换成功，就返回 <code>false</code>，否则返回 <code>true</code>，事实上，它并不是一个理想的判断函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="literal">NaN</span>))  <span class="comment">// logs true     不能转换</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="string">'123'</span>))  <span class="comment">// logs false  能转换</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="string">'abc'</span>))  <span class="comment">// logs true   不能转换</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="string">'123.45abc'</span>))  <span class="comment">// logs true   不能转换</span></span><br></pre></td></tr></table></figure></p>
<p>显然，它不能区分 <code>NaN</code> 和其他不能被转换的类型。</p>
<p>在 <code>ES5</code> 之前，利用 <code>NaN</code> 与其自身的绝对不相等性，以下方式能够更可靠的进行 <code>NaN</code> 的验证：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">isNaN</span> = <span class="function"><span class="keyword">function</span> (<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n !== n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="number">1</span>))   <span class="comment">// logs false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="string">'1.111'</span>))   <span class="comment">// logs false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">isNaN</span>(<span class="literal">NaN</span>))   <span class="comment">// logs true</span></span><br></pre></td></tr></table></figure></p>
<p>ES5 之后我们可以使用 <code>Number.isNaN()</code>来做判断，更安全可靠。</p>
<hr>


<h2 id="8-下面的代码会输出什么？为什么？"><a href="#8-下面的代码会输出什么？为什么？" class="headerlink" title="8.下面的代码会输出什么？为什么？"></a>8.下面的代码会输出什么？为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span> == <span class="number">0.3</span>);</span><br></pre></td></tr></table></figure>
<p>我们先看结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span>);  <span class="comment">//  0.30000000000000004</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">0.1</span> + <span class="number">0.2</span> == <span class="number">0.3</span>);  <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>这个问题本质上是在讲 <code>JavaScript</code> 在进行浮点数计算时精度丢失的问题。当然，不仅仅是 <code>JavaScript</code>，所有遵循 <code>IEEE 754</code> 标准的编程语言都存在这个问题。</p>
<p>这是什么原因导致的呢？就是十进制数在转化成二进制数时产生的精度丢失。我稍微演示下精度丢失的过程：</p>
<p>准备工作：想要理解精度是怎么丢失的，你先得理解十进制数是怎么转化为二进制数的。<br>十进制数转化为二进制数主要分为两步：<br><strong>1.整数部分按位取余，然后倒过来。比如：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//十进制 5 转化为二进制（向下取整）</span></span><br><span class="line"><span class="number">5</span>/<span class="number">2</span> = <span class="number">2</span> --- 余<span class="number">1</span></span><br><span class="line"><span class="number">2</span>/<span class="number">2</span> = <span class="number">1</span> --- 余<span class="number">0</span></span><br><span class="line"><span class="number">1</span>/<span class="number">2</span> = <span class="number">0</span> --- 余<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>所以 5 的二进制数据是 0101。</p>
<p><strong>2.小数部分按位乘2取整，得到积后取积的小数部分，然后再把这个积的小数部分乘2，用积取整，直到积的小数部分为0。比如：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//十进制 0.625 转化为二进制（按积取整）</span></span><br><span class="line"><span class="number">0.625</span> * <span class="number">2</span> = <span class="number">1.25</span> --- 取 <span class="number">1</span></span><br><span class="line"><span class="number">0.25</span> * <span class="number">2</span> = <span class="number">0.5</span>   --- 取 <span class="number">0</span></span><br><span class="line"><span class="number">0.5</span> * <span class="number">2</span> = <span class="number">1</span>      --- 取 <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>所以 0.625 的二进制数据是 0.101。</p>
<p>OK,准备工作做完了，我们来看看 0.1 的二进制数据是怎么转化的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> * <span class="number">2</span> = <span class="number">0.2</span> --- <span class="number">0</span></span><br><span class="line"><span class="number">0.2</span> * <span class="number">2</span> = <span class="number">0.4</span> --- <span class="number">0</span></span><br><span class="line"><span class="number">0.4</span> * <span class="number">2</span> = <span class="number">0.8</span> --- <span class="number">0</span></span><br><span class="line"><span class="number">0.8</span> * <span class="number">2</span> = <span class="number">1.6</span> --- <span class="number">1</span></span><br><span class="line"><span class="number">0.6</span> * <span class="number">2</span> = <span class="number">1.2</span> --- <span class="number">1</span></span><br><span class="line"><span class="number">0.2</span> * <span class="number">2</span> = <span class="number">0.4</span> --- <span class="number">0</span></span><br><span class="line"><span class="number">0.4</span> * <span class="number">2</span> = <span class="number">0.8</span> --- <span class="number">0</span></span><br><span class="line"><span class="number">0.8</span> * <span class="number">2</span> = <span class="number">1.6</span> --- <span class="number">1</span></span><br><span class="line"><span class="number">0.6</span> * <span class="number">2</span> = <span class="number">1.2</span> --- <span class="number">1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>看到这想必各位看官已经有所领悟了，若是碰到这种无限循环的数据，肯定是只能通过截取部分有效位来处理，所以在截取的过程中自然就会产生精度丢失。<br><code>0.1 -&gt; 0.000110011......0011</code><br><code>0.2 -&gt; 0.00110011......0011</code><br><code>0.1 + 0.2 -&gt; 0.010011001100110011001100110011001100110011001100110100</code><br>ok，我们再将这个被截取的二进制数按照二次幂的原则转化为十进制数是多少呢？<br><code>0.30000000000000004440892098500626</code><br>到此为止，我们已经知道了<code>0.30000000000000004</code>这个值是怎么来的了。</p>
<p>那么怎么处理呢？<br>1.部署一个误差检查函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">areTheNumbersAlmostEqual</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Math</span>.abs( num1 - num2 ) &lt; <span class="built_in">Number</span>.EPSILON;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(areTheNumbersAlmostEqual(<span class="number">0.1</span> + <span class="number">0.2</span>, <span class="number">0.3</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p><code>Number.EPSILON</code> 是 <code>ES6</code> 新增的一个极小的常量，它实际上是 <code>JavaScript</code> 能够表示的最小精度。误差如果小于这个值，就可以认为已经没有意义了，即不存在误差了。</p>
<p>2.在进行浮点数计算时，先讲浮点数转化为整型，计算后，在根据位数转化回小数。</p>
<hr>

<h2 id="9-ECMAscript-6-中的-Number-isInteger-用来确定是否是整数-在-ES5-中可以怎么实现？"><a href="#9-ECMAscript-6-中的-Number-isInteger-用来确定是否是整数-在-ES5-中可以怎么实现？" class="headerlink" title="9.ECMAscript 6 中的 Number.isInteger() (用来确定是否是整数) 在 ES5 中可以怎么实现？"></a>9.<code>ECMAscript 6</code> 中的 <code>Number.isInteger()</code> (用来确定是否是整数) 在 <code>ES5</code> 中可以怎么实现？</h2><p>在 <code>ECMAscript 6</code>中，我们可以很方便的使用<code>Number.isInteger()</code>来判断一个数是否为整数。但是在 <code>ES6</code> 以前，这是一件挺麻烦的事。</p>
<p>所以，一个最简单干净的解决办法是以下这种：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isInteger = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x ^ <span class="number">0</span>) === x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我来简单解释下<code>return (x ^ 0) === x</code>这句代码的含义。首先，你得明白 <code>JavaScript</code> 中按位异或的概念(以 ^ 来表示)：<code>即两个位数相等则为 0，不等则为 1。</code></p>
<p>举个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5 ^ 1 按位异或的过程：</span></span><br><span class="line"><span class="number">5</span> -&gt; <span class="number">0101</span></span><br><span class="line"><span class="number">1</span> -&gt; <span class="number">0001</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>^<span class="number">1</span> -&gt; <span class="number">0100</span></span><br><span class="line"><span class="number">5</span>^<span class="number">1</span> = <span class="number">4</span></span><br></pre></td></tr></table></figure></p>
<p>我们再来看这句代码:<code>return (x ^ 0) === x</code>,我们可以从两个方面来解释，<strong>第一，如果这个数它本来就是整数，那么会返回什么？</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span> -&gt; <span class="number">0101</span></span><br><span class="line"><span class="number">0</span> -&gt; <span class="number">0000</span></span><br><span class="line"><span class="number">5</span>^<span class="number">0</span> -&gt; <span class="number">0101</span></span><br><span class="line"><span class="number">5</span>^<span class="number">0</span> = <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>很显然我们得到结论，<strong>任何数和0按位异或时得到的结果都是它本身</strong>。<br><strong>ok，那么第二，当这个数不是整数呢？，我们看看会发生什么：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.1</span> ^ <span class="number">0</span> = <span class="number">5</span></span><br><span class="line"><span class="number">2.11111</span> ^ <span class="number">0</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>很奇怪不是吗？按照之前的理论，应该是下面这种过程才对啊：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.1</span> -&gt; <span class="number">0101.0001100110011</span>......<span class="number">.0011</span></span><br><span class="line"><span class="number">0</span> -&gt;   <span class="number">0000.0000000000000</span>......<span class="number">.0000</span></span><br><span class="line"><span class="number">5.1</span>^<span class="number">0</span>-&gt;<span class="number">0101.0001100110011</span>......<span class="number">.0011</span></span><br><span class="line"><span class="number">5.1</span>^<span class="number">0</span> = <span class="number">5.1</span></span><br></pre></td></tr></table></figure></p>
<p>这样才对呀！但是事实上并非如此，问题就出在小数部分的异或上面，我们接着看一个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> ^ <span class="number">0</span> = <span class="number">0</span>;</span><br><span class="line"><span class="number">0.2222</span> ^ <span class="number">0</span> = <span class="number">0</span>;</span><br><span class="line"><span class="number">1</span>/<span class="number">3</span> ^ <span class="number">0</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">0.1</span> ^ <span class="number">1</span> = <span class="number">1</span>;</span><br><span class="line"><span class="number">0.2222</span> ^ <span class="number">1</span> = <span class="number">1</span>;</span><br><span class="line"><span class="number">1</span>/<span class="number">3</span> ^ <span class="number">1</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>发现没有，在 <code>JavaScript</code> 中，任何小数与一个数（假定它为 a）异或时，都等于这个数 a。<br>这是为什么呢？我们打开 <a href="http://lzw.me/pages/ecmascript/" target="_blank" rel="noopener">ECMAScript5.1中文版</a></p>
<p>在 <strong><em>9.5 ToInt32：（32 位有符号整数）</em></strong>中，有以下内容：</p>
<blockquote>
<p>ToInt32 运算符将其在 -231 到 231-1 闭区间内的参数转换为 232 个整数值之一。此运算符功能如下所示：</p>
<p>对输入参数调用 ToNumber。<br>1.如果 Result(1) 是 +0 ，-0，+∞，或 -∞，返回 +0。<br>2.计算 sign(Result(1)) * floor(abs(Result(1)))。<br>3.计算 Result(3) modulo 232 ；也就是说，数值类型的有限整数值 k 为正，且小于 232 ，规模相对于 Result(3) 的数学值差异 ，232 是 k 的整数倍。<br>4.如果 Result(4) 是大于等于 231 的整数，返回 Result(4) - 232 ，否则返回 Result(4)。</p>
</blockquote>
<p>关键就在第 2 条中的这句话:<code>sign(Result(1)) * floor(abs(Result(1)))</code>中的<code>floor(x)</code>函数。</p>
<p>这玩意是怎么运作的呢？在<a href="http://lzw.me/pages/ecmascript/" target="_blank" rel="noopener">ECMAScript5.1中文版</a>中的 <strong>5.2 算法约定</strong>这一节中有明确的规定：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">floor(x) = x−(x modulo <span class="number">1</span>).</span><br></pre></td></tr></table></figure></p>
<p>什么意思呢？<strong>就是 floor(x) 等于 x 减去 x 模1。</strong>正是这一步，将小数部分的异或去掉了。</p>
<p>到这里，想必大家已经对上面那句简单的<code>return (x ^ 0) === x</code>有所领悟了。也正是因为这一特性，我们也可以使用下面这种方式来实现判断一个数是否为整数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isInteger = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">Math</span>.round(x) === x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当然，你可以更奔放些，像下面这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isInteger = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> (<span class="keyword">typeof</span> x === <span class="string">'number'</span>) &amp;&amp; (x % <span class="number">1</span> === <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是，要注意的是，<strong>我们不可以用下面这种方式来处理</strong>：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isInteger = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">parseInt</span>(x, <span class="number">10</span>) === x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是因为 <code>parseInt(string, radix)</code> 与 <code>Math.round(x)</code> 不同的作用机制导致的。<code>parseInt(string, radix)</code> 会将它的第一个值转化为字符串类型备用，而这正是问题所在，当一个特别大的数字被传入 <code>parseInt</code> 函数时，它会先将这个数转化为指数形式，就像下面这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(<span class="number">1000000000000000000000</span>, <span class="number">10</span>) </span><br><span class="line">-&gt; </span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">'1e+21'</span>, <span class="number">10</span>) </span><br><span class="line">=</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<hr>

<h2 id="10-在执行以下代码时，数字1-4将以什么顺序记录到控制台？为什么？"><a href="#10-在执行以下代码时，数字1-4将以什么顺序记录到控制台？为什么？" class="headerlink" title="10.在执行以下代码时，数字1-4将以什么顺序记录到控制台？为什么？"></a>10.在执行以下代码时，数字1-4将以什么顺序记录到控制台？为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>); </span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">2</span>)&#125;, <span class="number">1000</span>); </span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="number">3</span>)&#125;, <span class="number">0</span>); </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>首先先说答案：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>然后说结论：之所以会出现这个情况，4比3先执行，是因为要记住一点，<strong>定时器，都是异步执行的</strong>。<code>JavaScript</code> 对于异步执行的事件是有一个事件队列的，这个队列的执行优先级低于当前环境中代码的执行优先级，所以才会出现 4 比 3 先执行的情况。</p>
<hr>

<h2 id="11-编写一个简单的函数来判断某个字符串是否为回文结构"><a href="#11-编写一个简单的函数来判断某个字符串是否为回文结构" class="headerlink" title="11.编写一个简单的函数来判断某个字符串是否为回文结构"></a>11.编写一个简单的函数来判断某个字符串是否为回文结构</h2><p>首先，我和大家解释下什么是回文结构。</p>
<blockquote>
<p>按照维基百科的解释，回文结构就是将这个字符串的内容按相反的顺序重新排列后，所得到的字符串和原来的一样。</p>
</blockquote>
<p>ok，了解了这一点之后，咱们就可以看看其实现了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPalindrome</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  str = str.replace(<span class="regexp">/\W/g</span>, <span class="string">''</span>).toLowerCase();</span><br><span class="line">  <span class="keyword">return</span> (str == str.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(<span class="string">"level"</span>));                   <span class="comment">// logs 'true'</span></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(<span class="string">"levels"</span>));                  <span class="comment">// logs 'false'</span></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(<span class="string">"A car, a man, a maraca"</span>));  <span class="comment">// logs 'true'</span></span><br></pre></td></tr></table></figure></p>
<p>当然，上面这种方式由于夹杂了切割，翻转以及插入等各种操作，效率上会比较低，所以你还可以使用以下这种方式,从字符串头部和尾部，逐步往中间检测：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPalindrome</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  str = str.replace(<span class="regexp">/\W/g</span>, <span class="string">''</span>).toLowerCase();</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>,j = str.length - <span class="number">1</span>; i &lt; j; i++,j--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(str.charAt(i) !== str.charAt(j))&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(<span class="string">"level"</span>));                   <span class="comment">// logs 'true'</span></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(<span class="string">"levels"</span>));                  <span class="comment">// logs 'false'</span></span><br><span class="line"><span class="built_in">console</span>.log(isPalindrome(<span class="string">"A car, a man, a maraca"</span>));  <span class="comment">// logs 'true'</span></span><br></pre></td></tr></table></figure></p>
<hr>

<h2 id="12-编写一个sum方法，使用下面的语法调用时将正常工作。"><a href="#12-编写一个sum方法，使用下面的语法调用时将正常工作。" class="headerlink" title="12.编写一个sum方法，使用下面的语法调用时将正常工作。"></a>12.编写一个sum方法，使用下面的语法调用时将正常工作。</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">2</span>,<span class="number">3</span>));   <span class="comment">// Outputs 5</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">2</span>)(<span class="number">3</span>));  <span class="comment">// Outputs 5</span></span><br></pre></td></tr></table></figure>
<p>至少有两种方法可以做到这一点。<br><strong>方法一：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">arguments</span>.length == <span class="number">2</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">arguments</span>[<span class="number">0</span>] + <span class="built_in">arguments</span>[<span class="number">1</span>]; </span><br><span class="line">   &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>方法二：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">typeof</span> y != <span class="string">'undefined'</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span>  x + y; </span><br><span class="line">   &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于 arguments,我就不做过多的解释了，如果你对这个参数还没有概念，那么你要加油了。</p>
<hr>

<h2 id="13-请观察如下代码："><a href="#13-请观察如下代码：" class="headerlink" title="13.请观察如下代码："></a>13.请观察如下代码：</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</span><br><span class="line">  btn.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'Button '</span> + i));</span><br><span class="line">  btn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(i); &#125;);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(btn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>(a) 当你点击 “Button 4”的时候会打印什么内容？为什么？<br>(b) 至少提供一个可按预期工作的替代方案？</strong></p>
<p>很显然，这是一个 <code>JavaScrip</code>t 中经典的闭包问题。当你点击 “Button 4” 时，只会打印出 5，因为在你点击的时候这个循环早已经结束了。所以才会出现你无论你点击哪一个 Button 都会显示 5。</p>
<p>有关闭包的解释和预期方案我不做过多解释，我专门写有一篇博客介绍 <code>JavaScript</code> 闭包以及怎么处理它在循环中出现的问题。这是地址 <a href="https://blog.csdn.net/dk2290/article/details/78833697" target="_blank" rel="noopener">JavaScript 闭包机制的详解</a>。</p>
<p>当然，你也可以去MDN上看关于闭包的解释：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">MDN-闭包</a>。</p>
<hr>


<h2 id="14-下面的代码会输出什么内容到控制台，为什么？"><a href="#14-下面的代码会输出什么内容到控制台，为什么？" class="headerlink" title="14.下面的代码会输出什么内容到控制台，为什么？"></a>14.下面的代码会输出什么内容到控制台，为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = <span class="string">"john"</span>.split(<span class="string">''</span>);</span><br><span class="line"><span class="keyword">var</span> arr2 = arr1.reverse();</span><br><span class="line"><span class="keyword">var</span> arr3 = <span class="string">"jones"</span>.split(<span class="string">''</span>);</span><br><span class="line">arr2.push(arr3);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"array 1: length="</span> + arr1.length + <span class="string">" last="</span> + arr1.slice(<span class="number">-1</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"array 2: length="</span> + arr2.length + <span class="string">" last="</span> + arr2.slice(<span class="number">-1</span>));</span><br></pre></td></tr></table></figure>
<p>先给出答案，会输出以下内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"array 1: length= 5 last= j,o,n,e,s"</span></span><br><span class="line"><span class="string">"array 2: length= 5 last= j,o,n,e,s"</span></span><br></pre></td></tr></table></figure></p>
<p>接下来我再讲讲为什么。首先我先给出大家可能会疑惑的点：</p>
<ol>
<li><code>arr2 = [&#39;n&#39;, &#39;h&#39;, &#39;o&#39;, &#39;j&#39;, [&#39;j&#39;, &#39;o&#39;, &#39;n&#39;, &#39;e&#39;, &#39;s&#39;]]</code>,为什么<code>arr1.slice(-1)</code>输出的结果会是 <code>j,o,n,e,s</code>?</li>
<li>为什么 arr1 会输出和 arr2 一样的结果?</li>
</ol>
<p>ok,我们一个点一个点来讲。首先说说第一点， <code>arr.slice()</code> 方法返回的会是一个新数组，而且它是浅拷贝。所以如果单独看这句代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(arr2.slice(<span class="number">-1</span>))  <span class="comment">// logs [['j', 'o', 'n', 'e', 's']]</span></span><br></pre></td></tr></table></figure></p>
<p>之所以会出现 <strong>last= j,o,n,e,s</strong> 这样的结果，关键就在于 <code>console.log</code> 中的 “ last=” + 的这个 + 号。</p>
<p>我们先来看一个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> + [] = <span class="string">"1"</span></span><br><span class="line"><span class="number">1</span> + &#123;&#125; = <span class="string">"1[object object]"</span> </span><br><span class="line"><span class="number">1</span> + <span class="literal">NaN</span> = <span class="literal">NaN</span></span><br><span class="line">[] + &#123;&#125; = <span class="string">"[object object]"</span></span><br></pre></td></tr></table></figure></p>
<p>在 <code>JavaScript</code> 中加法其实归根到底还是 <strong>数字+数字</strong> 以及 <strong>字符串+字符串</strong>两种模式，所以在一个加法运算中，无论是什么类型的两个数据相加，结果必然是 number 或者 string 类型中的一个。至于这加法其中的门门道道，有兴趣的伙计可以看看我这篇博客：<a href="https://blog.csdn.net/dk2290/article/details/86534595" target="_blank" rel="noopener">JavaScript 中神奇的加法</a>。</p>
<p>再来说说第二点， 为什么 <code>arr1</code> 会输出和 <code>arr2</code> 一样的结果?如果你认真读过 <code>《JavaScript 高级程序设计（第三版）》</code>的话，你应该就知道为什么了。</p>
<p>翻开 JS高程 第70页，有这么一段话：</p>
<blockquote>
<p>当一个变量向另一个变量复制引用类型的值时，同样也会将储存在变量对象中的复制一份放到为新变量分配的空间中。不同的是，这个值的副本实际上是一个指针，而这个指针指向存储在堆中的一个对象。复制操作结束后，两个变量实际上将引用同一个对象。因此，改变一个变量，就会影响到另一个变量。</p>
</blockquote>
<p>那么什么是引用类型的变量呢？很简单，<code>object</code>  类型的都是引用类型变量，除了它，其他的形如 <code>number, string, boolean, null, undefined</code>都是数值类型的变量。</p>
<p>现在再回到我们上面那个题目，原因就一目了然了对吧。那么如果想避免这种情况怎么办？也很好办，第一个思路是<strong>重新给变量分配堆中的内存空间</strong>;第二个思路是<strong>将原对象解构后再重组，指针自然也就不再指向原来的对象了</strong>。我们来看例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = <span class="string">"john"</span>.split(<span class="string">''</span>);</span><br><span class="line"><span class="keyword">var</span> arr2 = [].concat(arr1.reverse());</span><br><span class="line"><span class="keyword">var</span> arr3 = <span class="string">"jones"</span>.split(<span class="string">''</span>);</span><br><span class="line">arr2.push(arr3);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"array 1: length="</span> + arr1.length + <span class="string">" last="</span> + arr1.slice(<span class="number">-1</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"array 2: length="</span> + arr2.length + <span class="string">" last="</span> + arr2.slice(<span class="number">-1</span>));</span><br></pre></td></tr></table></figure></p>
<p>会输出以下内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">array <span class="number">1</span>: length=<span class="number">4</span> last=j</span><br><span class="line">array <span class="number">2</span>: length=<span class="number">5</span> last=j,o,n,e,s</span><br></pre></td></tr></table></figure></p>
<p>当然，面对一些比较复杂的数据，你也可以尝试直接遍历解构来达到解除堆引用的目的。</p>
<hr>

<h2 id="15-下面的代码会输出什么内容到控制台中？为什么？"><a href="#15-下面的代码会输出什么内容到控制台中？为什么？" class="headerlink" title="15.下面的代码会输出什么内容到控制台中？为什么？"></a>15.下面的代码会输出什么内容到控制台中？为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> +  <span class="string">"2"</span> + <span class="string">"2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> +  +<span class="string">"2"</span> + <span class="string">"2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> +  -<span class="string">"1"</span> + <span class="string">"2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(+<span class="string">"1"</span> +  <span class="string">"1"</span> + <span class="string">"2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">"A"</span> - <span class="string">"B"</span> + <span class="string">"2"</span>);</span><br><span class="line"><span class="built_in">console</span>.log( <span class="string">"A"</span> - <span class="string">"B"</span> + <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>这是一个典型的 <code>JavaScript</code> 加减法问题，它体现了这门语言在类型转换和校验上的特点。</p>
<p>我们先来说说答案：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"122"</span></span><br><span class="line"><span class="string">"32"</span></span><br><span class="line"><span class="string">"02"</span></span><br><span class="line"><span class="string">"112"</span></span><br><span class="line"><span class="string">"NaN2"</span></span><br><span class="line"><span class="literal">NaN</span></span><br></pre></td></tr></table></figure></p>
<p>我简单解释下为什么会得到以下结果，如果你想了解其中的工作原理，建议你去看看我这篇文章，相信会给你带来一些收获：：<a href="https://blog.csdn.net/dk2290/article/details/86534595" target="_blank" rel="noopener">JavaScript 中神奇的加法</a>。</p>
<p>首先来看 <code>1 +  &quot;2&quot; + &quot;2&quot;</code>,根据加法中的 <strong>从左到右原则</strong> 和 <strong>凡有一个字符串就将其他变量转换为字符串原则</strong> 这两个原则，很容易得出 <code>&quot;122&quot;</code> 这个结果。</p>
<p>然后我们看看第2,3,4条，你会发现他们其实是类似的转换规则。无非就是在某个字符串前面加了一个<code>+</code>或者<code>-</code>。但是当这个<code>+</code>号只出现在单个变量的前面时，它就成一个二元运算符变成了一个一元运算符，其作用是将这个变量转换成 <code>number</code> 类型，其功能与 <code>Number()</code> 类似。</p>
<p>So~,我们再来看第2,3,4条，无非就是先把<code>+&quot;2&quot;</code>转为了<code>2</code>,<code>-&quot;1&quot;</code>转成了<code>-1</code>,然后再进行字符串拼接。这并不困难，伙计们可以想想下面这几个会是什么结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+<span class="literal">null</span> = ?</span><br><span class="line">+<span class="literal">undefined</span> = ?</span><br><span class="line">+<span class="literal">true</span> = ?</span><br><span class="line">+[] = ? </span><br><span class="line">+&#123;&#125; = ?</span><br><span class="line">+<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; = ?</span><br></pre></td></tr></table></figure></p>
<p>最后我们看看倒数两条，首先他们两都有减法，而减法是会将两个参与算术的变量都转成 <code>number</code> 类型，<code>&quot;A&quot;</code>转成 <code>number</code>类型自然就是 <code>NaN</code> 了。</p>
<hr>

<h2 id="16-如果数组列表太大，以下递归代码将导致堆栈溢出。你如何在保留递归的前提下解决这个问题？"><a href="#16-如果数组列表太大，以下递归代码将导致堆栈溢出。你如何在保留递归的前提下解决这个问题？" class="headerlink" title="16.如果数组列表太大，以下递归代码将导致堆栈溢出。你如何在保留递归的前提下解决这个问题？"></a>16.如果数组列表太大，以下递归代码将导致堆栈溢出。你如何在保留递归的前提下解决这个问题？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = readHugeList();</span><br><span class="line"><span class="keyword">var</span> nextListItem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> item = list.pop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (item) &#123;</span><br><span class="line">        <span class="comment">// process the list item...</span></span><br><span class="line">        nextListItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过修改 nextListItem 函数可以避免潜在的堆栈溢出，如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = readHugeList();</span><br><span class="line"><span class="keyword">var</span> nextListItem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> item = list.pop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (item) &#123;</span><br><span class="line">        <span class="comment">// process the list item...</span></span><br><span class="line">        setTimeout( nextListItem, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>利用事件循环机制（<code>Event Loop</code>）来处理递归而不是通过调用堆栈，因此消除了堆栈溢出。当 <code>nextListItem</code> 被调用时，如果 <code>item</code> 不为空且不为 <code>undefined</code>，定时器会将（<code>nextListItem</code>）加到任务队列中并结束对该函数的调用，从而留下一个干净的调用堆栈。当任务队列开始执行这个定时器里的内容时，将会处理下一次的事件并再次设置一个定时器以调用 <code>nextListItem</code>。因此，在没有进行直接递归调用的情况下来处理该函数，无论递归的次数是多少，调用栈都保持干净不会发生溢出现象。</p>
<hr>


<h2 id="17-什么是JavaScript中的“闭包”？举个例子。"><a href="#17-什么是JavaScript中的“闭包”？举个例子。" class="headerlink" title="17.什么是JavaScript中的“闭包”？举个例子。"></a>17.什么是JavaScript中的“闭包”？举个例子。</h2><p>我就不举例子也不解释了，大家可以直接看官网的答案，如果觉得它解释的不清晰的，可以看看我的这篇博客：<a href="https://blog.csdn.net/dk2290/article/details/78833697" target="_blank" rel="noopener">JavaScript 闭包机制的详解</a></p>
<hr>

<h2 id="18-以下代码的输出结果如何，解释你的答案。如何使用闭包有助于此？"><a href="#18-以下代码的输出结果如何，解释你的答案。如何使用闭包有助于此？" class="headerlink" title="18.以下代码的输出结果如何，解释你的答案。如何使用闭包有助于此？"></a>18.以下代码的输出结果如何，解释你的答案。如何使用闭包有助于此？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(i); &#125;, i * <span class="number">1000</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个典型的闭包，之前有好几个类似的问题，它会输以下答案：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>原因就是循环中定时器里的匿名函数形成了5个闭包，但是这5个闭包的执行上下文缺失同一个，因为早在定时器开始执行前 for 循环就已经结束了。</p>
<p><strong>解决办法一般是三种</strong>：</p>
<ol>
<li>用匿名执行函数把代码块包裹起来。</li>
<li>利用工厂函数。</li>
<li>利用 ES6 let 形成的块级作用域。</li>
</ol>
<p>下面是示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匿名执行函数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">	(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(i); &#125;, i * <span class="number">1000</span> )&#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//工厂函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logCallBack</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">	setTimeout(logCallBack(i), i * <span class="number">1000</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ES6  let</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(i); &#125;, i * <span class="number">1000</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>


<h2 id="19-以下代码行输出到控制台的内容是什么？请解释你的答案。"><a href="#19-以下代码行输出到控制台的内容是什么？请解释你的答案。" class="headerlink" title="19.以下代码行输出到控制台的内容是什么？请解释你的答案。"></a>19.以下代码行输出到控制台的内容是什么？请解释你的答案。</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"0 || 1 = "</span>+(<span class="number">0</span> || <span class="number">1</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"1 || 2 = "</span>+(<span class="number">1</span> || <span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"0 &amp;&amp; 1 = "</span>+(<span class="number">0</span> &amp;&amp; <span class="number">1</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"1 &amp;&amp; 2 = "</span>+(<span class="number">1</span> &amp;&amp; <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<p>这主要是考察 <code>JavaScript</code> 逻辑运算符的作用。先看结果：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> || <span class="number">1</span> = <span class="number">1</span></span><br><span class="line"><span class="number">1</span> || <span class="number">2</span> = <span class="number">1</span></span><br><span class="line"><span class="number">0</span> &amp;&amp; <span class="number">1</span> = <span class="number">0</span></span><br><span class="line"><span class="number">1</span> &amp;&amp; <span class="number">2</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>再来讲讲这三个逻辑运算符的作用，咱们先从逻辑与 &amp;&amp; 开始.</p>
<p><strong>1.逻辑与 &amp;&amp;</strong></p>
<ul>
<li>两边条件都为 <code>true</code> 时，结果才为 <code>true</code>；</li>
<li>如果有一个为 <code>false</code>，结果就为 <code>false</code>；</li>
<li>当第一个条件为 <code>false</code> 时，就不再判断后面的条件。</li>
</ul>
<p><strong>注意：当数值参与逻辑与运算时，结果为 true，那么会返回的会是第二个为真的值；如果结果为 false，返回的会是第一个为假的值。</strong></p>
<p><strong>2.逻辑或 ||</strong></p>
<ul>
<li>只要有一个条件为 <code>true</code> 时，结果就为 <code>true</code>；</li>
<li>当两个条件都为 <code>false</code> 时，结果才为 <code>false</code>；</li>
<li>当一个条件为 <code>true</code> 时，后面的条件不再判断。</li>
</ul>
<p><strong>注意：当数值参与逻辑或运算时，结果为 true，会返回第一个为真的值；如果结果为 false，会返回第二个为假的值。</strong></p>
<p><strong>3.逻辑非 !</strong></p>
<ul>
<li>当条件为 <code>false</code> 时，结果为 <code>true</code>；反之亦然。<hr>


</li>
</ul>
<h2 id="20-执行以下代码时输出结果是什么？请解释为什么。"><a href="#20-执行以下代码时输出结果是什么？请解释为什么。" class="headerlink" title="20.执行以下代码时输出结果是什么？请解释为什么。"></a>20.执行以下代码时输出结果是什么？请解释为什么。</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">false</span> == <span class="string">'0'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">false</span> === <span class="string">'0'</span>)</span><br></pre></td></tr></table></figure>
<p>这个其实也是隐式转换的问题。先说结果吧：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<p>原因就是在 <code>JavaScript</code> 中 <code>==</code> 运算符会进行隐式转换，也就是说上面的 <code>fasle</code> 会被 <code>Number()</code> 变成 <code>0</code> 然后再被 <code>toString()</code> 变成 <code>&quot;0&quot;</code>，所以为 <code>true</code>。</p>
<p>但是要注意的是，运算符 <code>===</code> 是不会进行隐式转换的，因为它要对比你的变量类型。 <code>false</code>为<code>boolean</code>，<code>&quot;0&quot;</code>为<code>string</code>,所以为<code>false</code>。</p>
<hr>


<h2 id="21-以下代码的输出是什么？请解释你的答案。"><a href="#21-以下代码的输出是什么？请解释你的答案。" class="headerlink" title="21.以下代码的输出是什么？请解释你的答案。"></a>21.以下代码的输出是什么？请解释你的答案。</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=&#123;&#125;,</span><br><span class="line">    b=&#123;<span class="attr">key</span>:<span class="string">'b'</span>&#125;,</span><br><span class="line">    c=&#123;<span class="attr">key</span>:<span class="string">'c'</span>&#125;;</span><br><span class="line"></span><br><span class="line">a[b]=<span class="number">123</span>;</span><br><span class="line">a[c]=<span class="number">456</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a[b]);</span><br></pre></td></tr></table></figure>
<p>此代码的输出将是 <code>456</code>（而不是<code>123</code>）。</p>
<p>原因如下：在设置对象的属性时，<code>JavaScript</code> 将隐式字符串化 <code>key</code> 值。在这种情况下，因为 b 和 c 都是对象，它们将都被转换成 <code>&quot;[object Object]&quot;</code>。所以无论是 <code>a[b]</code> 还是 <code>a[c]</code>其 <code>key</code> 值都相同。所以 <code>a[c]=456</code> 这一句代码实际上是更新了key为<code>[object object]</code> 的属性值。</p>
<hr>

<h2 id="22-以下代码将输出上面内容到控制台-并解释你的答案。-本题无过多深究内容，答案为官网答案"><a href="#22-以下代码将输出上面内容到控制台-并解释你的答案。-本题无过多深究内容，答案为官网答案" class="headerlink" title="22.以下代码将输出上面内容到控制台,并解释你的答案。(本题无过多深究内容，答案为官网答案)"></a>22.以下代码将输出上面内容到控制台,并解释你的答案。(本题无过多深究内容，答案为官网答案)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log((<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>)</span>&#123;<span class="keyword">return</span> ((n &gt; <span class="number">1</span>) ? n * f(n<span class="number">-1</span>) : n)&#125;)(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>
<p>代码将输出10阶乘的值（即10！或3,628,800）。<br>原因如下：<br>命名函数以 <code>f()</code> 递归方式调用自身，直到调用 <code>f(1)</code> 简单返回为止 <code>1</code>。因此，这就是它的作用：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f(<span class="number">1</span>): returns n, which is <span class="number">1</span></span><br><span class="line">f(<span class="number">2</span>): returns <span class="number">2</span> * f(<span class="number">1</span>), which is <span class="number">2</span></span><br><span class="line">f(<span class="number">3</span>): returns <span class="number">3</span> * f(<span class="number">2</span>), which is <span class="number">6</span></span><br><span class="line">f(<span class="number">4</span>): returns <span class="number">4</span> * f(<span class="number">3</span>), which is <span class="number">24</span></span><br><span class="line">f(<span class="number">5</span>): returns <span class="number">5</span> * f(<span class="number">4</span>), which is <span class="number">120</span></span><br><span class="line">f(<span class="number">6</span>): returns <span class="number">6</span> * f(<span class="number">5</span>), which is <span class="number">720</span></span><br><span class="line">f(<span class="number">7</span>): returns <span class="number">7</span> * f(<span class="number">6</span>), which is <span class="number">5040</span></span><br><span class="line">f(<span class="number">8</span>): returns <span class="number">8</span> * f(<span class="number">7</span>), which is <span class="number">40320</span></span><br><span class="line">f(<span class="number">9</span>): returns <span class="number">9</span> * f(<span class="number">8</span>), which is <span class="number">362880</span></span><br><span class="line">f(<span class="number">10</span>): returns <span class="number">10</span> * f(<span class="number">9</span>), which is <span class="number">3628800</span></span><br></pre></td></tr></table></figure></p>
<hr>


<h2 id="23-请考虑下面的代码段。控制台输出是什么以及为什么？"><a href="#23-请考虑下面的代码段。控制台输出是什么以及为什么？" class="headerlink" title="23.请考虑下面的代码段。控制台输出是什么以及为什么？"></a>23.请考虑下面的代码段。控制台输出是什么以及为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;)(<span class="number">2</span>)</span><br><span class="line">&#125;)(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>输出将是1，即使 <code>x</code> 从未在内部函数中设置值。原因如下：</p>
<p>闭包是一个函数，以及创建闭包时在范围内的所有变量或函数(其实就是执行上下文)。在 <code>JavaScript</code> 中，闭包被实现为“内部函数”; 即，在另一个函数体内定义的函数。闭包的一个重要特性是内部函数仍然可以访问外部函数的变量。</p>
<p>因此，在此示例中，由于x未在内部函数中定义，因此在外部函数的范围内搜索已定义的变量x，该变量的值为1。</p>
<p>如果理解不了这段内容，请自行 google 或者看一下我这篇关于闭包的博客：<a href="https://blog.csdn.net/dk2290/article/details/78833697" target="_blank" rel="noopener">JavaScript 闭包机制的详解</a></p>
<hr>

<h2 id="24-以下代码将输出上面内容到控制台？这段代码有什么问题，如何解决？"><a href="#24-以下代码将输出上面内容到控制台？这段代码有什么问题，如何解决？" class="headerlink" title="24.以下代码将输出上面内容到控制台？这段代码有什么问题，如何解决？"></a>24.以下代码将输出上面内容到控制台？这段代码有什么问题，如何解决？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hero = &#123;</span><br><span class="line">    _name: <span class="string">'John Doe'</span>,</span><br><span class="line">    getSecretIdentity: <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stoleSecretIdentity = hero.getSecretIdentity;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(stoleSecretIdentity());</span><br><span class="line"><span class="built_in">console</span>.log(hero.getSecretIdentity());</span><br></pre></td></tr></table></figure>
<p>这个问题本质上来说，是有关 <code>JavaScript</code> 中 <code>this</code> 的指向问题，先放上答案：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">undefined</span></span><br><span class="line">John Doe</span><br></pre></td></tr></table></figure></p>
<p>为什么呢？我们先看第一个函数 <code>stoleSecretIdentity()</code>,它的执行上下文是哪？很明显是<code>window</code>,而第二个函数 <code>hero.getSecretIdentity()</code> 呢？执行上下文是 <code>hero</code>,这就是他们两的输出结果不同的原因所在。</p>
<p>至于有关 this 的指向问题的详细解释，你可以 google 一下，也可以看看我这篇文章：：<a href="https://blog.csdn.net/dk2290/article/details/82587118" target="_blank" rel="noopener">javascript this探究</a></p>
<hr>

<h2 id="25-实现一个函数，其功能是在给定页面上的DOM元素的情况下，访问元素本身及其所有后代（而不仅仅是其直接子元素）。对于访问的每个元素，函数应该将该元素传递给提供的回调函数。"><a href="#25-实现一个函数，其功能是在给定页面上的DOM元素的情况下，访问元素本身及其所有后代（而不仅仅是其直接子元素）。对于访问的每个元素，函数应该将该元素传递给提供的回调函数。" class="headerlink" title="25.实现一个函数，其功能是在给定页面上的DOM元素的情况下，访问元素本身及其所有后代（而不仅仅是其直接子元素）。对于访问的每个元素，函数应该将该元素传递给提供的回调函数。"></a>25.实现一个函数，其功能是在给定页面上的DOM元素的情况下，访问元素本身及其所有后代（而不仅仅是其直接子元素）。对于访问的每个元素，函数应该将该元素传递给提供的回调函数。</h2><h2 id="函数的参数应该是：-1-一个DOM元素。-2-回调函数（以DOM元素为参数）"><a href="#函数的参数应该是：-1-一个DOM元素。-2-回调函数（以DOM元素为参数）" class="headerlink" title="函数的参数应该是： 1.一个DOM元素。 2.回调函数（以DOM元素为参数）"></a>函数的参数应该是： 1.一个DOM元素。 2.回调函数（以DOM元素为参数）</h2><p>访问树的所有元素是经典的优先深度优先搜索算法,看如下实例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Traverse</span>(<span class="params">p_element,p_callback</span>) </span>&#123;</span><br><span class="line">   p_callback(p_element);</span><br><span class="line">   <span class="keyword">var</span> list = p_element.children;</span><br><span class="line">   <span class="comment">// 把len缓存起来在数据量大时可以提高部分性能</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>,len = list.length;i &lt; len; i++) &#123;</span><br><span class="line">       Traverse(list[i],p_callback);  <span class="comment">// recursive call</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>

<h2 id="26-以下代码的输出是什么？"><a href="#26-以下代码的输出是什么？" class="headerlink" title="26.以下代码的输出是什么？"></a>26.以下代码的输出是什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> length = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  length: <span class="number">5</span>,</span><br><span class="line">  method: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    fn();</span><br><span class="line">    <span class="built_in">arguments</span>[<span class="number">0</span>]();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.method(fn, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>很明显这又是一道<code>this</code>指向的问题。但是它比之前的题目更隐蔽，需要你完全理解<code>this</code>在 <code>JavaScript</code> 中是怎么调用的。</p>
<p>先看答案：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span> </span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p><code>fn</code> 被当成参数传给了 <code>method</code> 函数，而 <code>obj.method(fn, 1)</code> 的执行上下文是 <code>windows</code>,所以 <code>fn</code> 的调用者显然就是 <code>windows</code>,而此时 <code>windows</code> 环境中有一个 <code>var length = 10;</code>，所以这时输出的就是 <code>10</code>;我们再来看 <code>arguments[0]();</code> 这句代码，这句代码等同于下面这句:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = [fn, <span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> fn = <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line">fn();</span><br></pre></td></tr></table></figure></p>
<p>事实上 <code>arguments</code> 是什么我们不再多说，如果你不了解我建议你多踏实基础。所以调用方或则说此时这个 <code>fn</code> 的执行上下文是 <code>arguments</code>,它的 <code>length</code> 是 <code>2</code>，所以最后输出 <code>2</code>。</p>
<hr>


<h2 id="27-请考虑以下代码-输出内容是什么，为什么？"><a href="#27-请考虑以下代码-输出内容是什么，为什么？" class="headerlink" title="27.请考虑以下代码,输出内容是什么，为什么？"></a>27.请考虑以下代码,输出内容是什么，为什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (x) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = <span class="number">1</span>, y = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">    <span class="built_in">console</span>.log(y);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>这道题其实考察的是 <code>JavaScript</code> 引擎在执行代码时关于声明提示的问题。以上代码块也可以认为是下面这种形式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x,y;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (x) &#123;</span><br><span class="line">        x = <span class="number">1</span>;</span><br><span class="line">        y = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'inner'</span>，x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'outer'</span>，x);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'outer'</span>，y);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>我简单解释下，首先呢，<code>JavaScript</code> 中的变量提升我就不多说了，所以<code>var x,y;</code>会在闭包的最顶端。其次就是这句代码了:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span> (x) &#123;</span><br><span class="line">        x = <span class="number">1</span>;</span><br><span class="line">        y = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>这个 <code>catch(x)</code> 是关键，它意味着对这个块级作用域内的x进行了局部声明，而撇开了外部的全局声明，所以 <code>inner x</code> 输出的值应该是 <code>1</code>,而 <code>outer x</code> 输出的值应该是 <code>undefined</code>。而 <code>y</code> 并没有被局部重新声明，所以 <code>y</code> 的输出应该就是 <code>2</code>。</p>
<hr>

<h2 id="28-下面这段代码的输出是什么？"><a href="#28-下面这段代码的输出是什么？" class="headerlink" title="28.下面这段代码的输出是什么？"></a>28.下面这段代码的输出是什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">var</span> girl = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">20</span>;</span><br><span class="line">&#125;;</span><br><span class="line">girl ();</span><br></pre></td></tr></table></figure>
<p>先说结果，输出是 <code>undefined</code>。也许有人会认为是20，或者是21，但是很明显你们都有理解上的误差。我先举个大家好理解的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">var</span> girl = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;;</span><br><span class="line">girl();   <span class="comment">// 21</span></span><br></pre></td></tr></table></figure></p>
<p>看到问题所在了吗？关键就在于 <code>var x = 20;</code> 这句代码，为什么？因为它会发生变量提升，对 <code>window</code> 环境下的变量 <code>a</code> 进行重新声明，就如同下面的代码一样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">21</span>;</span><br><span class="line"><span class="keyword">var</span> girl = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">    x = <span class="number">20</span>;</span><br><span class="line">&#125;;</span><br><span class="line">girl ();</span><br></pre></td></tr></table></figure></p>
<p>所以，打印的结果自然也就是 <code>undefined</code> 了。</p>
<hr>

<h2 id="29-在-JavaScript-中如何克隆一个对象？"><a href="#29-在-JavaScript-中如何克隆一个对象？" class="headerlink" title="29.在 JavaScript 中如何克隆一个对象？"></a>29.在 <code>JavaScript</code> 中如何克隆一个对象？</h2><p>首先我们要明白一个概念，那就是克隆分为<strong>浅克隆</strong>和<strong>深克隆</strong>两种类型，我们通常说的对象克隆，其实就是指的对象的深克隆。</p>
<p>关于浅克隆深克隆的更为详细的解释，我就不在本文介绍了，大家可以看这篇博文 <a href="https://blog.csdn.net/dk2290/article/details/87774932" target="_blank" rel="noopener">JavaScript 中的浅拷贝和深拷贝</a>，下面我就简单介绍下两种深克隆的方式：</p>
<p><strong>1.序列化与反序列化</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="string">'str'</span>, <span class="attr">c</span>:&#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">20</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> objCopy = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">objCopy.c.age = <span class="number">18</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj)   </span><br><span class="line"><span class="built_in">console</span>.log(objCopy)</span><br></pre></td></tr></table></figure></p>
<p><strong>2.<code>for...in</code> 深递归</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span> || <span class="keyword">typeof</span> obj === <span class="string">'function'</span>) &amp;&amp; obj !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">let</span> isArray = <span class="built_in">Array</span>.isArray(obj); </span><br><span class="line">     <span class="keyword">var</span> cloneObj = isArray ? [] : &#123;&#125;;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:&#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">10</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> copyObj = deepClone(obj);</span><br><span class="line">copyObj.c.age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'obj'</span>, obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'copyObj'</span>, copyObj)</span><br></pre></td></tr></table></figure></p>
<p><hr></p>
<h2 id="30-以下这段代码输出什么内容？"><a href="#30-以下这段代码输出什么内容？" class="headerlink" title="30.以下这段代码输出什么内容？"></a>30.以下这段代码输出什么内容？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(i); &#125;, i * <span class="number">1000</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个典型的<strong>块级作用域</strong>的问题。先说答案，将会打印出<code>0,1,2,3,4</code>。</p>
<p><strong>原因就在于 <code>let</code> 会形成一个块级作用域，使得变量 <code>i</code> 只在 <code>for</code> 循环中生效。</strong></p>
<hr>

<h2 id="31-以下这段代码输出什么内容？"><a href="#31-以下这段代码输出什么内容？" class="headerlink" title="31.以下这段代码输出什么内容？"></a>31.以下这段代码输出什么内容？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> &lt; <span class="number">2</span> &lt; <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span> &gt; <span class="number">2</span> &gt; <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>这道题我认为实际上考察的是 <code>JavaScript</code> 的类型隐式转换。<br>第一行代码<code>console.log(1 &lt; 2 &lt; 3);</code>,首先进行的是<code>1 &lt; 2</code>,表达式成立返回结果 <code>true</code>,然后进行第二个表达式 <code>true &lt;３</code>,这时 <code>true</code> 被隐式转换为 <code>1</code>, 即 <code>1 &lt; 3</code>，表达式成立，最终返回结果 <code>true</code>。</p>
<p>第二行代码<code>console.log(3 &gt; 2 &gt; 1);</code>,首先进行的是<code>3 &gt; 2</code>,表达式成立返回结果 <code>true</code>,然后进行第二个表达式 <code>true &gt; 1</code>,这时 <code>true</code> 被隐式转换为 <code>1</code>, 即 <code>1 &gt; 1</code>，表达式不成立，最终返回结果 <code>false</code>。</p>
<p>所以最后输出结果应为 <code>true</code> 和 <code>false</code>。</p>
<hr>

<h2 id="32-JavaScript-中如何在数组的头部和尾部插入元素？"><a href="#32-JavaScript-中如何在数组的头部和尾部插入元素？" class="headerlink" title="32.JavaScript 中如何在数组的头部和尾部插入元素？"></a>32.JavaScript 中如何在数组的头部和尾部插入元素？</h2><p>对于传统的ES5来说，我们可以通过以下方式来进行插入元素：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'bb'</span>];</span><br><span class="line">arr.push(<span class="string">'cc'</span>); <span class="comment">// ['bb', 'cc']</span></span><br><span class="line">arr.unshift(<span class="string">'aa'</span>)  <span class="comment">// ['aa', 'bb', 'cc']</span></span><br></pre></td></tr></table></figure></p>
<p>对于ES6来说，我们可以使用扩展预算符进行解构赋值：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">'aa'</span>,<span class="string">'bb'</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="string">'dd'</span>, ...arr, <span class="string">'cc'</span>]; <span class="comment">// ['dd', 'aa', 'bb', 'cc']</span></span><br></pre></td></tr></table></figure></p>
<p><hr></p>
<h2 id="33-如果你有以下代码："><a href="#33-如果你有以下代码：" class="headerlink" title="33.如果你有以下代码："></a>33.如果你有以下代码：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = [1, 2, 3];</span><br><span class="line"></span><br><span class="line">a） a[10] = 99;</span><br><span class="line">b） console.log(a[6]);</span><br></pre></td></tr></table></figure>
<h2 id="a）这会导致崩溃吗？"><a href="#a）这会导致崩溃吗？" class="headerlink" title="a）这会导致崩溃吗？"></a>a）这会导致崩溃吗？</h2><h2 id="b）这个输出是什么？"><a href="#b）这个输出是什么？" class="headerlink" title="b）这个输出是什么？"></a>b）这个输出是什么？</h2><p>先说答案：<br>a&gt; 不会崩溃，<code>JavaScript</code> 会将中间空闲的元素位置为空插槽(<code>&lt;7 empty items&gt;</code>),实际输出如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, &lt;<span class="number">7</span> empty items&gt;, <span class="number">99</span> ]</span><br></pre></td></tr></table></figure></p>
<p>这里需要注意一点，这些空插槽在不同的环境下表现可能有所不同：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">a[<span class="number">10</span>] = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; a.length;i++)&#123;</span><br><span class="line">    a[i] = <span class="number">7</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(a)  <span class="comment">// [7, 7, 7, 7, 7, 7, 7]</span></span><br></pre></td></tr></table></figure></p>
<p>显然数组 <code>a</code> 的元素会变成7。<br>我们再看一个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">a[<span class="number">10</span>] = <span class="number">99</span>;</span><br><span class="line">a.map(<span class="function"><span class="params">e</span> =&gt;</span> <span class="number">7</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// [ 1, 2, 3, &lt;7 empty items&gt;, 99 ]</span></span><br></pre></td></tr></table></figure></p>
<p>此时的结果却又不同于 <code>for</code> 循环，原因是 <code>empty items</code>并没有在 <code>map</code> 中被赋值，而是保留了下来。</p>
<p>b&gt; 很明显输出会是 <code>undefined</code>。</p>
<hr>

<h2 id="34-typeof-undefined-typeof-NULL-会输出什么结果？"><a href="#34-typeof-undefined-typeof-NULL-会输出什么结果？" class="headerlink" title="34.typeof undefined == typeof NULL 会输出什么结果？"></a>34.<code>typeof undefined == typeof NULL</code> 会输出什么结果？</h2><p>这道题是典型的心机题，因为此题中的 <code>NULL</code> 并不是我们所熟知的那个 <code>null</code>,原因嘛，自然是 <code>JavaScript</code> 中是区分大小写的。</p>
<p>如果是 <code>typeof undefined == typeof null</code>,那么输出结果自然是 <code>false</code>, 因为<code>typeof undefined = &quot;undefined&quot;</code>, 而 <code>typeof null = &quot;object&quot;</code> 。</p>
<p>而当 <code>typeof undefined == typeof NULL</code>时，自然输出结果是 <code>true</code> 了，因为此时 <code>NULL</code> 相当于一个未定义的变量，<code>typeof NULL = &quot;undefined&quot;</code>。</p>
<hr>

<h2 id="35-下面的代码会返回什么？"><a href="#35-下面的代码会返回什么？" class="headerlink" title="35.下面的代码会返回什么？"></a>35.下面的代码会返回什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">typeof</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>这道题主要考察你对 <code>MDN</code> 熟不熟，我们看下 <code>MDN</code> 上对 <code>typeof</code> 操作符的定义：</p>
<blockquote>
<p>typeof 操作符返回一个字符串，表示未经计算的操作数的类型。</p>
</blockquote>
<p>所以答案显而易见就是 <code>string</code>。</p>
<hr>

<h2 id="36-下面的代码会返回什么？"><a href="#36-下面的代码会返回什么？" class="headerlink" title="36.下面的代码会返回什么？"></a>36.下面的代码会返回什么？</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   	<span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        b++;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="number">3</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(b)</span><br><span class="line">    &#125;</span><br><span class="line">    inner();</span><br><span class="line">&#125;</span><br><span class="line">outer();</span><br></pre></td></tr></table></figure>
<p>这是一道考察 <code>JavaScript</code> 作用域链的问题，先说答案：<code>3</code>。</p>
<p><strong>要确定为什么，只需要确定两点：</strong></p>
<ol>
<li>输出的代码处在哪个作用域。</li>
<li>从此作用域往上去找需要输出的变量，找到实例为止。</li>
</ol>
<p>在函数 <code>inner</code>中是需要输出的作用域，而 <code>inner</code> 中本就有变量 <code>b</code> 的实例，所以 <code>b</code> 为 3。</p>
<p>此外，再说说在 <code>inner</code> 中的变量提升，<code>inner</code>中的 <code>b</code> 将按照以下顺序执行：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b;</span><br><span class="line">        b++; <span class="comment">// b is undefined</span></span><br><span class="line">        b++; <span class="comment">// b is NaN</span></span><br><span class="line">        b = <span class="number">3</span>; <span class="comment">// b is 3</span></span><br><span class="line">        <span class="built_in">console</span>.log  <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2018/02/13/TopTal 进阶 JavaScript 面试题/" data-id="cjtvit7cm0017uovdfs5bev0f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试题/">面试题</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SVG基本图形的创建和动画详解——1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/13/SVG基本图形的创建和动画详解——1/" class="article-date">
  <time datetime="2018-01-13T11:34:20.000Z" itemprop="datePublished">2018-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/13/SVG基本图形的创建和动画详解——1/">SVG基本图形的创建和动画详解——1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-引言"><a href="#一-引言" class="headerlink" title="一.引言"></a>一.引言</h2><p>SVG全称为“Scalable Vector Graphics”，意为可缩放矢量图形。而什么是矢量图？矢量就是向量，所以矢量图就意味着无限缩放而不改变图片的质量。<br>　　<br>多说无益，下面放MDN上关于SVG的定义：</p>
<blockquote>
<p>SVG是XML语言的一种形式，有点类似XHTML，它可以用来绘制矢量图形，例如右面展示的图形。SVG可以通过定义必要的线和形状来创建一个图形，也可以修改已有的位图，或者将这两种方式结合起来创建图形。图形和其组成部分可以变形，可以合成，还可以通过滤镜完全改变外观。</p>
</blockquote>
<p>　　SO~你可以像创建html dom元素一样，用类似的标签来愉快的创建各种矢量图形。当然，SVG有一套自己的规范。老规矩，关门放MDN：</p>
<blockquote>
<p>HTML提供了定义标题、段落、表格等等内容的元素。与此类似，SVG 也提供了一些元素，用于定义圆形、矩形、简单或复杂的曲线，以及其他形状。一个简单的 SVG 文档由 svg 根元素和基本的形状元素构成。另外还有一个 g 元素，它用来把若干个基本形状编成一个组。从这些开始，SVG  可以成为任何复杂的组合图形。SVG 支持渐变、旋转、滤镜效果、JavaScript 接口等等功能，但是所有这些额外的语言特性，都需要在一个定义好的图形区域内实现。</p>
</blockquote>
<h2 id="二-简单图形的创建"><a href="#二-简单图形的创建" class="headerlink" title="二.简单图形的创建"></a>二.简单图形的创建</h2><p><strong>1.线(line)</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"100"</span> height=<span class="string">"100"</span>&gt;</span><br><span class="line">　　&lt;line x1=<span class="string">"0"</span> y1=<span class="string">"0"</span> x2=<span class="string">"200"</span> y2=<span class="string">"200"</span> style=<span class="string">"stroke:rgb(255,0,0);stroke-width:2"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163210873?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG线条"><br>上诉标签<code>&lt;line /&gt;</code>就是SVG专门用来创建线的元素。其中X1与y1代表第一个坐标在X轴和Y轴中的位置，X2，Y2以此类推。而最终出现的图形就是这两个点连起来形成的闭合路径。　　</p>
<p><strong>2.折线(polyline)</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"200"</span>&gt;</span><br><span class="line">  &lt;polyline points=<span class="string">"20,20 40,25 60,40 80,120 120,140 200,180"</span> style=<span class="string">"fill:none;stroke:black;stroke-width:3"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>　　结果：<br>　　<img src="https://img-blog.csdn.net/20180828163251651?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG折线"><br>　　<br>上述标签<code>&lt;polyline/&gt;</code>就是SVG专门用来创建折线的元素。关于points的详细解释请看下面的多边形(polygon)。</p>
<p><strong>3.矩形(rect)</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"100"</span>&gt;</span><br><span class="line">   &lt;rect width=<span class="string">"200"</span>height=<span class="string">"100"</span>　style=<span class="string">"fill:rgb(0,0,255);stroke-width:1;stroke:rgb(0,0,0)"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163400558?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG rect矩形"><br><code>&lt;rect /&gt;</code>就是SVG专门用来创建矩形的元素。且无需设定坐标。<br>　　<br>　　<br><strong>4.圆形(circle)</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"100"</span>&gt;</span><br><span class="line">   &lt;circle cx=<span class="string">"100"</span> cy=<span class="string">"50"</span> r=<span class="string">"40"</span> stroke=<span class="string">"black"</span> stroke-width=<span class="string">"2"</span> fill=<span class="string">"red"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163444569?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG圆形"><br><code>&lt;circle /&gt;</code>就是SVG专门用来创建圆形的元素。cx和cy表示圆心的坐标，r表示圆的半径。<br>　<br>　　<br><strong>5.椭圆(ellipse)</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"100"</span>&gt;</span><br><span class="line">  &lt;ellipse cx=<span class="string">"100"</span> cy=<span class="string">"50"</span> rx=<span class="string">"90"</span> ry=<span class="string">"40"</span> style=<span class="string">"fill:yellow"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163505925?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG椭圆"><br><code>&lt;ellipse /&gt;</code>就是SVG专门用来创建椭圆形的元素。cx和cy表示圆心的坐标，rx表示圆心到椭圆左右两侧的半径，ry表示圆心到椭圆上下两侧的半径。<br>　　<br>　　<br><strong>6.多边形(polygon)</strong></p>
<p><strong>6.1 三角形</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"100"</span>&gt;</span><br><span class="line">  &lt;polygon points=<span class="string">"100,0 40,80 160,80"</span> style=<span class="string">"fill:gray"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163527284?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG polygon 三角形"><br><code>&lt;polygon /&gt;</code>在用来创建多边形时，关键的属性就在于points。以上面那个例子来说，“100,0”为一个坐标，分别表示这个点在x轴和y轴的位置。坐标点与坐标点之间以空格分开。最终的图形就是这几个点连起来成的闭合路径形成的图案。<br>　　<br><strong>6.2 矩形</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"500"</span> height=<span class="string">"500"</span>&gt;</span><br><span class="line">  &lt;polygon points=<span class="string">"10,10 170,10 170,80 10,80"</span> style=<span class="string">"fill:gray"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163601136?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG polygon矩形"><br>由此可见，<code>&lt;polygon /&gt;</code>也可以用来创建矩形。</p>
<p><strong>6.3 六边形</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"500"</span> height=<span class="string">"500"</span>&gt;</span><br><span class="line">  &lt;polygon points=<span class="string">"0,40 30,0 100,0 130,40 100,80 30,80"</span> style=<span class="string">"fill:gray"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163625971?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG polygon六边形"><br>从这个points里的坐标点可以看出，svg渲染points里的点是从左往右渲染的，也就是说你在写坐标点时也要按照这个顺序来。<br>　　<br><strong>6.4 星形</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"200"</span>&gt;</span><br><span class="line">  &lt;polygon points=<span class="string">"100,10 40,180 190,60 10,60 160,180"</span> style=<span class="string">"fill:gray;"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>结果：<br>　　<img src="https://img-blog.csdn.net/20180828163708952?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这是SVG polygon星形"><br>这个星形就是同通过按顺序描点连线后生成的图形，描点顺序大概如下：<br>　 <img src="https://img-blog.csdn.net/20180828163731661?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="星形描点顺序"><br>所以只要捋清楚你要画的图形的描点顺序和大概坐标，就可以画出很多复杂的图形。
　 
　 </p>
<h2 id="三-复杂图形的创建"><a href="#三-复杂图形的创建" class="headerlink" title="三.复杂图形的创建"></a>三.复杂图形的创建</h2><p>复杂图形的创建，要用到<code>&lt;path /&gt;</code>这个元素。</p>
<p>MDN对path的解释为:</p>
<blockquote>
<p>path元素是用来定义形状的通用元素。所有的基本形状都可以用path元素来创建。</p>
</blockquote>
<p>当然，<code>&lt;path /&gt;</code>里也提供了一个重要的属性来绘制图形，那就是d。MDN上对 path d属性的描述如下：</p>
<blockquote>
<p>The d attribute provides a path definition to be drawn.<br>A path definition is a list of path commands where each command is made of a letter and some numbers representing the parameter of the command. All possible commands are detailed below.</p>
</blockquote>
<p>大概意思就是：</p>
<blockquote>
<p>d属性提供了要绘制的路径定义。<br>路径定义是路径命令的列表，其中每个命令都由一个字母组成，一些数字表示命令的参数。所有可能的命令如下所示。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">M = moveto</span><br><span class="line">L = lineto</span><br><span class="line">H = horizontal lineto</span><br><span class="line">V = vertical lineto</span><br><span class="line">C = curveto</span><br><span class="line">S = smooth curveto</span><br><span class="line">Q = quadratic Bézier curve</span><br><span class="line">T = smooth quadratic Bézier curveto</span><br><span class="line">A = elliptical Arc</span><br><span class="line">Z = closepath</span><br></pre></td></tr></table></figure>
<p>需要注意的一点是，以上所有命令都可以才用大小写，大写代表绝对定位，小写代表相对定位(比如相对上一个节点移动10px)<br>下面我们就讲讲这些命令的含义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">M ：【绘制作图开始点】                                                        </span><br><span class="line">L ：【绘制作图结束点】</span><br><span class="line">H ：【绘制平行线】</span><br><span class="line">V ：【绘制垂直线】</span><br><span class="line">C ：【三次贝塞尔曲线】</span><br><span class="line">S ：【简写三次贝塞尔曲线】</span><br><span class="line">Q ：【二次贝塞尔曲线】</span><br><span class="line">T ：【简写二次贝塞尔曲线】</span><br><span class="line">A ：【绘制椭圆弧】</span><br><span class="line">Z ：【闭合路径】</span><br></pre></td></tr></table></figure>
<p>下面根据顺序举例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> M <span class="number">10</span> <span class="number">10</span>表示需要移动到的点的x轴和y轴的坐标。</span><br><span class="line"><span class="number">2.</span> L <span class="number">10</span> <span class="number">20</span>表示在当前位置和新位置（L前面画笔所在的点）之间画一条线段。</span><br><span class="line"><span class="number">3.</span> H <span class="number">30</span>表示绘制一段<span class="number">30</span>的水平线。</span><br><span class="line"><span class="number">4.</span> V <span class="number">20</span>表示绘制一段<span class="number">20</span>的垂直线。</span><br></pre></td></tr></table></figure></p>
<p> <strong>5.三次贝塞尔曲线C：</strong></p>
<blockquote>
<p>C x1 y1, x2 y2, x y<br>(x,y)表示的是曲线的终点，(x1,y1)是起点的控制点，(x2,y2)是终点的控制点。<br>控制点描述的是曲线起始点的斜率。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"200"</span> height=<span class="string">"100"</span>&gt;</span><br><span class="line">  &lt;path d=<span class="string">"M10 10 C 20 20, 40 20, 50 10"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：<br><img src="https://img-blog.csdn.net/20180828165119778?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>什么意思呢？从M声明的(10,10)到C的最后一个坐标(50,10)。而这条曲线曲折的程度这取决于两个控制点的斜率。起点的斜率是M(10,10)与C(20,20)连成的起点的直线的斜率。这条直线就是起点沿起点控制点的切线。终点的斜率以此类推。</p>
<p><strong>6.简写三次贝塞尔曲线S</strong></p>
<blockquote>
<p>S x2 y2, x y<br>如果S命令跟在一个C命令或者另一个S命令的后面，它的第一个控制点，就会被假设成前一个控制点的对称点。如果S命令单独使用，前面没有C命令或者另一个S命令，那么它的两个控制点就会被假设为同一个点。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"190px"</span> height=<span class="string">"160px"</span> &gt;</span><br><span class="line">  &lt;path d=<span class="string">"M10 80 C 40 10, 65 10, 95 80 S 150 150, 180 80"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：<br><img src="https://img-blog.csdn.net/20180828165203643?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>也就是说，当你需要对称的曲线时，你可以使用S指令。</p>
<p><strong>7.二次贝塞尔曲线Q</strong></p>
<blockquote>
<p>Q x1 y1, x y<br>二次贝塞尔曲线Q，只需要一个控制点和一个终点坐标。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"190px"</span> height=<span class="string">"160px"</span>&gt;</span><br><span class="line">  &lt;path d=<span class="string">"M10 80 Q 95 10 180 80"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：<br><img src="https://img-blog.csdn.net/2018082816522598?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><strong>8.简写二次贝塞尔曲线T</strong></p>
<blockquote>
<p>T x y<br>T只需要一个控制点就可以绘制出与上一条曲线对称的曲线。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"190px"</span> height=<span class="string">"160px"</span>&gt;</span><br><span class="line">  &lt;path d=<span class="string">"M10 80 Q 52.5 10, 95 80 T 180 80"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"transparent"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：<br><img src="https://img-blog.csdn.net/20180828165342699?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>需要注意的是，在使用T命令时要确保它的前面是一个Q命令或者T命令。如果单独使用了T命令，会绘制出一条直线，因为控制点和终点会被认为是一个点。</p>
<p><strong>9.弧形A</strong></p>
<blockquote>
<p>A rx ry x-axis-rotation large-arc-flag sweep-flag x y</p>
</blockquote>
<p>以下是各参数的含义(可对照椭圆<code>&lt;ellipse /&gt;</code>的参数含义)：</p>
<blockquote>
<p>rx ry ：椭圆的两个半轴的长度。<br>x-axis-rotation ： 椭圆相对于坐标系的旋转角度，角度数而非弧度数。<br>large-arc-flag ： 标记绘制大弧(1)还是小弧(0)部分。<br>sweep-flag ： 标记向顺时针(1)还是逆时针(0)方向绘制。<br>x y ： 圆弧终点的坐标。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"320px"</span> height=<span class="string">"320px"</span>&gt;</span><br><span class="line">  &lt;path d=<span class="string">"M10 315 L110 215 A30 50 0 0 1 162.55 162.45 L172.55 152.45 A30 50 -45 0 1 215.1 109.9 L315 10"</span> stroke=<span class="string">"black"</span> fill=<span class="string">"green"</span> stroke-width=<span class="string">"2"</span> fill-opacity=<span class="string">"0.5"</span>/&gt;</span><br><span class="line">&lt;<span class="regexp">/svg&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图：<br><img src="https://img-blog.csdn.net/20180828165353717?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><strong>10.闭合路径Z</strong><br>这个就不用过多解释了。在某些情况下使用Z命令可以省下写L命令来闭合路径。</p>
<p>SVG基本图形的创建大概就这些，下一节我们聊聊SVG的动画模块，以及SVG动画的内存回收。</p>
<h2 id="四-参考资料"><a href="#四-参考资料" class="headerlink" title="四.参考资料"></a>四.参考资料</h2><ol>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial" target="_blank" rel="noopener">SVG教程-MDN</a></li>
<li><a href="http://www.runoob.com/svg/svg-path.html" target="_blank" rel="noopener">SVG <path>-菜鸟教程</path></a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2018/01/13/SVG基本图形的创建和动画详解——1/" data-id="cjtvibbc3000guovdc3fcr37d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML/">HTML</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JavaScript 中的浅拷贝和深拷贝" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/23/JavaScript 中的浅拷贝和深拷贝/" class="article-date">
  <time datetime="2017-12-23T06:13:20.000Z" itemprop="datePublished">2017-12-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/23/JavaScript 中的浅拷贝和深拷贝/">JavaScript 中的浅拷贝和深拷贝</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一.前言"></a>一.前言</h2><p>每一个前端的 JavaScript 之路不一定是由《JavaScript 高级程序设计》开启的，但是每一位前端都一定被“按值传递”和“按引用传递”这两个概念坑过。现在你我应该都很清楚，在 JavaScript 中的<code>object</code>类型是按引用传递的，但是在函数参数中，所有参数都是按值传递的。</p>
<p>我们今天要谈的东西，就起源于<code>object</code>型数据的复制与再操作，简单来说，就是我们今天的主题：对象的浅拷贝和深拷贝。</p>
<h2 id="二-按引用传递是什么含义？"><a href="#二-按引用传递是什么含义？" class="headerlink" title="二.按引用传递是什么含义？"></a>二.按引用传递是什么含义？</h2><p>首先，我们需要快速回想一下在 JavaScript 中基本数据类型有哪些,请看下面：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> number</span><br><span class="line"><span class="number">2.</span> string</span><br><span class="line"><span class="number">3.</span> boolean</span><br><span class="line"><span class="number">4.</span> <span class="literal">null</span></span><br><span class="line"><span class="number">5.</span> <span class="literal">undefined</span></span><br><span class="line"><span class="number">6.</span> symbol</span><br></pre></td></tr></table></figure></p>
<p>引用数据类型只有一种：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object</span><br></pre></td></tr></table></figure></p>
<p>当然，由此衍生出来的变种也有很多，包括<code>Array,function</code>等等，也可以看成是对象的一种。</p>
<p>接着我们得复习下 JavaScript 的堆栈中是怎么存储数据的。在 JS 中内存的使用和分配与其他语言也大同小异：</p>
<blockquote>
<p>堆是动态分配内存，内存大小不一，也不会自动释放。栈是自动分配相对固定大小的内存空间，并由系统自动释放。</p>
</blockquote>
<p>对以上6种基本数据类型来说，</p>
<p>当我们在 JavaScript 中声明一个简单基础数据类型并初始化它的值时：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> NAME = <span class="string">'waw'</span>;</span><br></pre></td></tr></table></figure></p>
<p>此时这个值将以键值对的形式<code>key:&#39;NAME&#39;, value:&#39;waw&#39;</code>保存在栈中。</p>
<p>但是对引用类型的数据来说却并不是如此，对它来说，虽然也是以键值对形式存储于栈中，但是<code>value</code>部分存储的是指向堆中的地址，如：<code>key:&#39;NAME&#39;, value: 指向堆的指针</code>,而<code>value</code>真正的值则存储在堆中。<strong>而在 JavaScript 中是不允许直接操作堆中的内容的，所以我们日常操作对象时实际上操作的是对象的引用。</strong></p>
<p>到这儿为止，咱们的提前知识储备已经差不多了，从上面的内容我们可以达成一个基础的共识，那就是基础数据类型是没有浅拷贝深拷贝之说的，大家都是存储在栈中的社会主义公民，都很平等。所以为了接下来讲解的层次性，我将从数组和对象，基本数据类型和引用数据类型，两种角度出发来给大家讲讲浅拷贝和深拷贝。</p>
<h2 id="三-JavaScript-的浅拷贝"><a href="#三-JavaScript-的浅拷贝" class="headerlink" title="三.JavaScript 的浅拷贝"></a>三.JavaScript 的浅拷贝</h2><p><strong>3.1 从基本数据类型的数组角度来说</strong></p>
<p>形如<code>var arr = [1, &#39;1&#39;, true, null, undefined, Symbol()]</code>，这一类数组内元素的集合，我们都可以称它们为基本数据类型的数组。</p>
<p>浅拷贝最简单的就是<code>var a = b</code>了。举个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="string">'1'</span>, <span class="literal">true</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="built_in">Symbol</span>()];</span><br><span class="line"><span class="keyword">var</span> arrCopy = arr;</span><br><span class="line">arrCopy[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr)   </span><br><span class="line"><span class="built_in">console</span>.log(arrCopy)</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><img src="https://img-blog.csdnimg.cn/20190219174506509.png" alt="在这里插入图片描述"></p>
<p>很明显，这就是个最简单的浅拷贝。当然我们也可以自己实现一个基础的浅拷贝函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shallowClone</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> cloneObj = &#123;&#125;; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.hasOwnProperty(key))&#123;</span><br><span class="line">            cloneObj[key] = obj[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>3.2 从引用数据类型的数组角度来说</strong></p>
<p>什么是引用数据类型的数组？举个简单例子，形如<code>[[1, 2], {age: 1}, Number(1), String(2)]</code>的数组内元素的集合，都可以称为引用数据类型。当然，我们平常在业务中最常见的就是多维数组或者是对象数组。</p>
<p>对它来说，浅拷贝最直接的方式也是<code>var a = b</code>;举个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [[<span class="number">1</span>, <span class="number">2</span>], &#123;<span class="attr">age</span>: <span class="number">1</span>&#125;, <span class="built_in">Number</span>(<span class="number">1</span>), <span class="built_in">String</span>(<span class="number">2</span>)];</span><br><span class="line"><span class="keyword">var</span> arrCopy = arr;</span><br><span class="line">arrCopy[<span class="number">0</span>] = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(arr)   </span><br><span class="line"><span class="built_in">console</span>.log(arrCopy)</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><img src="https://img-blog.csdnimg.cn/20190219174606995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>3.3 从对象角度来说</strong></p>
<p>从对象角度来说，它就不像数组那样好区分基本数据类型和引用数据类型了，因为毕竟是<code>key=&gt; value</code>键值对形式来存储的结构。</p>
<p>我们一般也可以通过<code>var a=b</code>来进行浅拷贝。举个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = &#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> arrCopy = arr;</span><br><span class="line">arrCopy.name = <span class="string">'gcc'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr)   </span><br><span class="line"><span class="built_in">console</span>.log(arrCopy)</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><img src="https://img-blog.csdnimg.cn/20190219174623645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>这儿有个很有意思的事，ES6有一个<code>Object.assgin()</code>方法，可以拷贝(合并)对象并返回新对象。我们试试用它来复制上面的对象看会输出什么：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = &#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> arrCopy = <span class="built_in">Object</span>.assign(&#123;&#125;, arr);</span><br><span class="line">arrCopy.name = <span class="string">'gcc'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr)   </span><br><span class="line"><span class="built_in">console</span>.log(arrCopy)</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><img src="https://img-blog.csdnimg.cn/20190219174634895.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>emmm…从结果来看，像是一个深拷贝方法，不着急，我们试试稍微复杂的结构：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = &#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">1</span>, <span class="attr">love</span>:&#123; <span class="attr">ball</span>: <span class="string">'football'</span>, <span class="attr">game</span>: <span class="string">'tecent'</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">var</span> arrCopy = <span class="built_in">Object</span>.assign(&#123;&#125;, arr);</span><br><span class="line">arrCopy.love.game= <span class="string">'alibaba'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr);   </span><br><span class="line"><span class="built_in">console</span>.log(arrCopy);</span><br></pre></td></tr></table></figure></p>
<p>结果如下：<br><img src="https://img-blog.csdnimg.cn/20190219175709424.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>你还可以试试其他层次大于一级的对象结构，我们会发现<code>Object.assign()</code>这个方法在大于一级的对象结构下进行的都是浅拷贝。所以，我们一般是建议在业务里如果想使用深拷贝来处理对象，避免使用<code>Object.assign()</code>函数。</p>
<h2 id="四-JavaScript-的深拷贝"><a href="#四-JavaScript-的深拷贝" class="headerlink" title="四.JavaScript 的深拷贝"></a>四.JavaScript 的深拷贝</h2><p>要谈深拷贝，首先我们要有一个共识，就是何为<strong>深拷贝</strong>？简单来说，<strong>就是对某个对象会不断递归去遍历复杂对象中的每一个层级，最后输出的这样一个过程</strong>，可以称之为深拷贝。有了这个前提，我们再来看看深拷贝在数组和对象中的具体实现。</p>
<p><strong>4.1 从基本数据类型的数组角度来说</strong></p>
<p>对于数组的深拷贝来说，其实你可以从这个角度出发：</p>
<blockquote>
<p>在 JavaScript 中所有操作数组的方法里，如果此操作是不修改原数组而是返回新数组，那么可以判定这个方法可以做到深拷贝。</p>
</blockquote>
<p>接下来我用几个例子来支撑上面这个理论:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">var</span> arrCopySlice = arr.slice(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> arrCopyConcat = [].concat(arr);</span><br><span class="line"><span class="keyword">var</span> arrCopyMap = arr.map(<span class="function"><span class="params">el</span> =&gt;</span> el);</span><br><span class="line"><span class="keyword">var</span> arrCopyFilter = arr.filter(<span class="function"><span class="params">el</span> =&gt;</span> el);</span><br><span class="line"><span class="keyword">var</span> arrCopy = [...arr];</span><br><span class="line">arrCopySlice[<span class="number">0</span>] = <span class="string">'test'</span>;</span><br><span class="line">arrCopyConcat[<span class="number">0</span>] = <span class="string">'test'</span>;</span><br><span class="line">arrCopyMap[<span class="number">0</span>] = <span class="string">'test'</span>;</span><br><span class="line">arrCopyFilter[<span class="number">0</span>] = <span class="string">'test'</span>;</span><br><span class="line">arrCopy[<span class="number">0</span>] = <span class="string">'test'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'arr'</span>, arr)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'arrCopySlice'</span>, arrCopySlice)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'arrCopyConcat'</span>, arrCopyConcat)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'arrCopyMap'</span>, arrCopyMap)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'arrCopyFilter'</span>, arrCopyFilter)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'arrCopy'</span>, arrCopy)</span><br></pre></td></tr></table></figure></p>
<p>可以看到，我使用了<code>arr.slice(), arr.concat(), arr.map(), arr.filter(), [...arr]</code>这五个方法，以上5个方法都是满足<code>在不修改原数组的前提下返回新数组</code>这一原则。输出结果如下：<br><img src="https://img-blog.csdnimg.cn/20190220090754510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>从输出可以看出，改变了<code>arrCopy</code>并不会影响原数组<code>arr</code>。当然，我们还可以换句话来理解：</p>
<blockquote>
<p> 所谓数组深拷贝，也可以理解为无论此数组内的数据有多少层级，它都可以一层层遍历去获取。</p>
</blockquote>
<p><strong>而以上5个例子，我们要注意都是基本数据类型，这意味着大家都是一层的结构，更深的层次，以上5个方法，都做不到深拷贝了，要切记这一点。</strong></p>
<p><strong>4.2 从引用数据类型的数组角度来说</strong></p>
<p>这儿也有个很有意思的事，我们对数组使用<code>Object.assgin()</code>方法时，也是可以拷贝数组的，但是结果与拷贝对象有所不同：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="string">'1'</span>, &#123;<span class="attr">a</span>:<span class="number">11</span>&#125;];</span><br><span class="line"><span class="keyword">var</span> arrCopy = <span class="built_in">Object</span>.assign([],arr);</span><br><span class="line">arrCopy[<span class="number">2</span>].a = <span class="number">22</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr)   </span><br><span class="line"><span class="built_in">console</span>.log(arrCopy)</span><br></pre></td></tr></table></figure></p>
<p>结果如下:<br><img src="https://img-blog.csdnimg.cn/20190220091103223.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>结果与对对象进行 <code>Object.assgin()</code> 操作时不同，为浅拷贝，<strong>所以对于数组来说，一级结构也不能使用 <code>Object.assgin()</code> 来进行深拷贝。</strong></p>
<p>对于更深层的数组或是对象(二级结构或以上)来说，我们一般会采取两种思路：</p>
<ol>
<li>序列化和序列化。(即 <code>JSON.parse()</code>和 <code>JSON.stringify()</code>)</li>
<li>深递归</li>
</ol>
<p>所以这两种思路就放在对象的深拷贝里一起讲了。</p>
<p><strong>4.3 从对象角度来说</strong></p>
<p>主要说说两种思路。</p>
<p><strong>第一种，序列化和反序列化</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="string">'str'</span>, <span class="attr">c</span>:&#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">20</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> objCopy = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">objCopy.c.age = <span class="number">18</span>;</span><br><span class="line"><span class="built_in">console</span>.log(obj)   </span><br><span class="line"><span class="built_in">console</span>.log(objCopy)</span><br></pre></td></tr></table></figure></p>
<p>输出结果如下：<br><img src="https://img-blog.csdnimg.cn/20190220091629364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>就平常的业务情况来说，肯定是够用的，当然它也不是银弹，它只能处理对象和数组内容，除此之外的 <code>reg</code>，<code>date</code>，<code>err</code>等类型对象都无法处理。</p>
<p><strong>第二种. for in 深递归</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span> || <span class="keyword">typeof</span> obj === <span class="string">'function'</span>) &amp;&amp; obj !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">let</span> isArray = <span class="built_in">Array</span>.isArray(obj); </span><br><span class="line">     <span class="keyword">var</span> cloneObj = isArray ? [] : &#123;&#125;;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:&#123;<span class="attr">name</span>:<span class="string">'waw'</span>, <span class="attr">age</span>:<span class="number">10</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> copyObj = deepClone(obj);</span><br><span class="line">copyObj.c.age = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'obj'</span>, obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'copyObj'</span>, copyObj)</span><br></pre></td></tr></table></figure></p>
<p>输出结果如下：<br><img src="https://img-blog.csdnimg.cn/20190220091648176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="五-深拷贝的特殊情况"><a href="#五-深拷贝的特殊情况" class="headerlink" title="五.深拷贝的特殊情况"></a>五.深拷贝的特殊情况</h2><p><strong>5.1 <code>Date</code> 和 <code>RegExp</code> 对象的深拷贝失效</strong></p>
<p>在 MDN 的<code>结构化克隆算法</code>中有这么一段话：<br><img src="https://img-blog.csdnimg.cn/20190220091856310.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>对应到我们现在的问题来说，意味着<code>error</code>, <code>Date</code>, <code>RegExp</code> 以及 <code>Function</code> 对象不能被上面的所深克隆。</p>
<p>举个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">date</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="attr">reg</span>:<span class="regexp">/reg/g</span>, <span class="attr">func</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> copyObj = deepClone(obj);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'obj'</span>, obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'copyObj'</span>, copyObj)</span><br></pre></td></tr></table></figure></p>
<p>我们可以看到结果：<br><img src="https://img-blog.csdnimg.cn/20190220092044135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><code>copyObj</code>里的属性全是空对象<code>{}</code>,深拷贝失败。</p>
<p>怎么解决呢？可以通过构建它们对应的构造函数来处理这个问题：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span> || <span class="keyword">typeof</span> obj === <span class="string">'function'</span>) &amp;&amp; obj !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">let</span> cloneObj;</span><br><span class="line">     <span class="keyword">let</span> Constructor = obj.constructor;</span><br><span class="line">     <span class="keyword">switch</span>(Constructor)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">RegExp</span>:</span><br><span class="line">            cloneObj = <span class="keyword">new</span> Constructor(obj);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">Date</span>:</span><br><span class="line">            cloneObj = <span class="keyword">new</span> Constructor(<span class="built_in">Number</span>(obj));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            cloneObj = <span class="keyword">new</span> Constructor();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key]) : obj[key]</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">date</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="attr">reg</span>:<span class="regexp">/reg/g</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> copyObj = deepClone(obj);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'obj'</span>, obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'copyObj'</span>, copyObj)</span><br><span class="line"><span class="built_in">console</span>.log(obj.date === copyObj.date)</span><br><span class="line"><span class="built_in">console</span>.log(obj.reg === copyObj.reg)</span><br></pre></td></tr></table></figure></p>
<p>输出如下：<br><img src="https://img-blog.csdnimg.cn/20190220092321370.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>5.2 环对象</strong></p>
<p>什么是环对象？形如下面这种结构就叫环对象：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">obj.private = obj;</span><br></pre></td></tr></table></figure></p>
<p>我们用上面的那个 <code>deepClone()</code> 函数对此对象进行复制，则会抛出栈溢出的异常：<code>Maximum call stack size exceeded</code>。</p>
<p>怎么处理呢？其实原理也简单，就是用一个哈希表来存储已经拷贝过的内容，然后在拷贝前对哈希表里的内容进行判断，如果对象已经存在，则直接返回此对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span> || <span class="keyword">typeof</span> obj === <span class="string">'function'</span>) &amp;&amp; obj !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj, hash = new WeakMap(</span>))</span>&#123;</span><br><span class="line">     <span class="keyword">let</span> cloneObj;</span><br><span class="line">     <span class="keyword">let</span> Constructor = obj.constructor;</span><br><span class="line">     <span class="keyword">if</span>(hash.has(obj))&#123;</span><br><span class="line">        <span class="keyword">return</span> hash.get(obj);</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">switch</span>(Constructor)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">RegExp</span>:</span><br><span class="line">            cloneObj = <span class="keyword">new</span> Constructor(obj);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">Date</span>:</span><br><span class="line">            cloneObj = <span class="keyword">new</span> Constructor(<span class="built_in">Number</span>(obj));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            cloneObj = <span class="keyword">new</span> Constructor();</span><br><span class="line">            hash.set(obj, cloneObj);</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        cloneObj[key] = isObject(obj[key]) ? deepClone(obj[key], hash) : obj[key]</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> cloneObj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">date</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="attr">reg</span>:<span class="regexp">/reg/g</span>&#125;;</span><br><span class="line">obj.private = obj;</span><br><span class="line"><span class="keyword">let</span> copyObj = deepClone(obj);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'obj'</span>, obj)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'copyObj'</span>, copyObj)</span><br></pre></td></tr></table></figure></p>
<p>输出结果如下：<br><img src="https://img-blog.csdnimg.cn/20190220092721619.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我们可以看到，<code>private</code> 中是一个 <code>Circular</code> 对象，即无限自循环对象。拷贝是成功的。</p>
<p>你也可以把上面的代码放到浏览器中执行，就可以看到 <code>Circular</code> 对象的具体内容：<br><img src="https://img-blog.csdnimg.cn/2019022009284967.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>5.3 原型链上的属性</strong></p>
<p>我们知道，函数有<code>protorype</code>属性，被称为原型链。对象也有原型链，其属性名为<code>__proto__</code>。如果你想拷贝某个对象<code>__proto__</code>上的属性，你可以使用<code>for...in</code>。看个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">	name:<span class="string">'waw'</span>,</span><br><span class="line">	age:<span class="number">11</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> obj2 = <span class="built_in">Object</span>.create(obj);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj2)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出结果如下：<br><img src="https://img-blog.csdnimg.cn/20190220092901535.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RrMjI5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>我们可以看到，<code>obj2</code> 本是一个空对象，并没有属性，但是 <code>for...in</code> 却打印出了 <code>name</code> 和 <code>age</code> 属性，从上图也可以看出，这两个属性实际上是原型链 <code>__proto__</code> 上的属性。</p>
<p>到这里深拷贝的内容差不多就结束了，其实还有很多可以继续挖掘的地方，比如说：<code>Symbol</code> 类型的深拷贝， <code>Symbol</code> 类型作为 <code>key</code> 时的深拷贝，不可枚举属性的深拷贝，<code>function</code> 类型的深拷贝等等，由于篇幅原因就不在此篇文章中细说了，忙完手里的事我会再接着写一篇后续来补充更深入的内容。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2017/12/23/JavaScript 中的浅拷贝和深拷贝/" data-id="cjtvibbb2000euovd3xly69wh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JavaScript this探究" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/11/JavaScript this探究/" class="article-date">
  <time datetime="2017-12-11T12:25:48.000Z" itemprop="datePublished">2017-12-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/11/JavaScript this探究/">JavaScript this 探究</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>关于javascript的this讲解的文章已经多如牛毛了，我本人在开发过程中也用到过很多次。这次趁有空，整理一下关于this的一系列问题：包括this的指向，严格模式和非严格模式下的区别，什么情况下可以改变this的指向以及在ES6下箭头函数中this的指向。</p>
<h2 id="一-严格模式下this的指向"><a href="#一-严格模式下this的指向" class="headerlink" title="一.严格模式下this的指向"></a>一.严格模式下this的指向</h2><p>严格模式下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="keyword">this</span>)   <span class="comment">//undefined</span></span><br><span class="line">&#125;</span><br><span class="line">aa();</span><br></pre></td></tr></table></figure></p>
<p>非严格模式下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)   <span class="comment">//window</span></span><br><span class="line">&#125;</span><br><span class="line">aa();</span><br></pre></td></tr></table></figure></p>
<h2 id="二-this的指向"><a href="#二-this的指向" class="headerlink" title="二.this的指向"></a>二.this的指向</h2><p>MDN中对this的解释如下：</p>
<blockquote>
<p>在绝大多数情况下，函数的调用方式决定了this的值。this不能在执行期间被赋值，并且在每次函数被调用时this的值也可能会不同。</p>
</blockquote>
<p>简单点来说，this的指向在声明时是未定义的，只有在它被调用时才会被赋值，要搞清楚它到底指向什么，只要搞清楚到底谁调用它即可。</p>
<p><strong>下面有几种情况可以帮助我们加快理解this的指向问题:</strong></p>
<p><strong>1.第一种情况：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>)   <span class="comment">//window</span></span><br><span class="line">&#125;</span><br><span class="line">aa();</span><br></pre></td></tr></table></figure></p>
<p>此时是window对象调用了aa()函数，所以this指向window。</p>
<p><strong>2.第二种情况</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = &#123;</span><br><span class="line">  aa:<span class="string">"hello"</span>,  </span><br><span class="line">  bb:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.aa)  <span class="comment">//"hello"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test.bb();</span><br></pre></td></tr></table></figure></p>
<p>此时是test对象调用了this，所以this此时指向的bb对象中的aa;<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = &#123;</span><br><span class="line">  aa:<span class="string">"hello"</span>,  </span><br><span class="line">  bb:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)  <span class="comment">//test (object)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test.bb();</span><br></pre></td></tr></table></figure></p>
<p>此时就很清晰的能看到this指向的test对象。</p>
<p><strong>3.第三种情况</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = &#123;</span><br><span class="line">  aa:<span class="string">"hello"</span>,  </span><br><span class="line">  bb:&#123;</span><br><span class="line">    aa:<span class="string">'hello2'</span>,</span><br><span class="line">    cc:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.aa)  <span class="comment">//"hello2"</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test.bb.cc();</span><br></pre></td></tr></table></figure></p>
<p>此时调用cc中this的对象是bb，而不是test，所以this指向的是bb。</p>
<p>以上三个例子已经比较清晰的解释了this的指向问题：<br><strong>谁最后调用了this，谁就是this指向的对象。</strong></p>
<h2 id="三-什么情况下this的指向会被改变"><a href="#三-什么情况下this的指向会被改变" class="headerlink" title="三.什么情况下this的指向会被改变"></a>三.什么情况下this的指向会被改变</h2><p>这些情况大致可以分为两类：</p>
<blockquote>
<p><strong>1.关键字类。主要有new，return<br>  2.函数类。 主要有call,apply,bind</strong></p>
</blockquote>
<p><strong>第一类.关键字类</strong><br>我们先看new的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = <span class="string">"Tom"</span>    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bb = aa(); <span class="comment">//bb is undefined;</span></span><br><span class="line"><span class="keyword">var</span> bb = <span class="keyword">new</span> aa();</span><br><span class="line"><span class="built_in">console</span>.log(bb.name)  <span class="comment">//"Tom"</span></span><br></pre></td></tr></table></figure></p>
<p>new关键字的关键在于实例化了构造函数aa()。使它的函数能够顺利的拿到里面的name。</p>
<p>return的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = <span class="string">"Tom"</span>;</span><br><span class="line">   <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bb = <span class="keyword">new</span> aa();</span><br><span class="line"><span class="built_in">console</span>.log(bb.name)  <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure></p>
<p>当return的内容是一个对象时，则this会指向这个对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.name = <span class="string">"Tom"</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">'aaa'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bb = <span class="keyword">new</span> aa();</span><br><span class="line"><span class="built_in">console</span>.log(bb.name)  <span class="comment">//"Tom"</span></span><br></pre></td></tr></table></figure></p>
<p>当return的内容是一个非对象时，则this的指向不会发生改变。</p>
<p><strong>第二类.函数类</strong></p>
<p><strong>1.call()函数</strong><br>老规矩，先关门放MDN。</p>
<blockquote>
<p><strong>call() 方法调用一个函数,其具有一个指定的this值和分别地提供的参数(参数的列表)。</strong></p>
</blockquote>
<p>简单来说就是可以通过call()函数来指定你想调用的this所造的环境，同时还可以追加多个参数。<br>以下是MDN上的官方示例:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Product</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Food</span>(<span class="params">name, price</span>) </span>&#123;</span><br><span class="line">  Product.call(<span class="keyword">this</span>, name, price);</span><br><span class="line">  <span class="keyword">this</span>.category = <span class="string">'food'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Food(<span class="string">'cheese'</span>, <span class="number">5</span>).name);</span><br><span class="line"><span class="comment">// expected output: "cheese"</span></span><br></pre></td></tr></table></figure></p>
<p>如果没有调用call()函数，最后打印的应该是food，调用后才会改成cheese。如果觉得上面的例子还不够清晰，我们可以再看一个，如果觉得ok了，请跳过。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aa = &#123;</span><br><span class="line">   name:<span class="string">"tom"</span>,</span><br><span class="line">   bb:<span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);  <span class="comment">//"tom"</span></span><br><span class="line">        <span class="built_in">console</span>.log(x,y);  <span class="comment">// 1,2</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = aa.bb</span><br><span class="line">b.call(aa);</span><br><span class="line">b.call(aa,<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>2.apply函数</strong></p>
<blockquote>
<p><strong>apply() 方法调用一个具有给定this值的函数，以及作为一个数组（或类似数组对象）提供的参数。</strong><br><strong>该方法的作用和 apply()方法类似，只有一个区别，就是call()方法接受的是若干个参数的列表，而apply()方法接受的是一个包含多个参数的数组。</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aa = &#123;</span><br><span class="line">   name:<span class="string">"tom"</span>,</span><br><span class="line">   bb:<span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);  <span class="comment">//"tom"</span></span><br><span class="line">        <span class="built_in">console</span>.log(x,y);  <span class="comment">// 1,2</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = aa.bb</span><br><span class="line">b.apply(aa,[<span class="number">1</span>,<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<p><strong>3.bind函数</strong></p>
<blockquote>
<p><strong>bind()方法创建一个新的函数， 当这个新函数被调用时其this置为提供的值，其参数列表前几项置为创建时指定的参数序列。</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">  x: <span class="number">42</span>,</span><br><span class="line">  getX: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unboundGetX = <span class="built_in">module</span>.getX;</span><br><span class="line"><span class="built_in">console</span>.log(unboundGetX()); <span class="comment">// The function gets invoked at the global scope</span></span><br><span class="line"><span class="comment">// expected output: undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> boundGetX = unboundGetX.bind(<span class="built_in">module</span>);</span><br><span class="line"><span class="built_in">console</span>.log(boundGetX());</span><br><span class="line"><span class="comment">// expected output: 42</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，bind函数与apply和call都有所不同，不同之处在于bind不是立即执行的。</p>
<blockquote>
<p><strong>bind() 函数会创建一个新绑定函数，绑定函数与被调函数具有相同的函数体（在 ECMAScript 5 中）。</strong></p>
</blockquote>
<p>我们看一个例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aa = &#123;</span><br><span class="line">    name:<span class="string">"tom"</span>,</span><br><span class="line">    bb:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cc = aa.bb;</span><br><span class="line"><span class="keyword">var</span> dd = cc.bind(aa);</span><br><span class="line"><span class="built_in">console</span>.log(dd);  <span class="comment">//type function aa()</span></span><br><span class="line">dd(); <span class="comment">// "tom"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="三-ES6箭头函数中的this"><a href="#三-ES6箭头函数中的this" class="headerlink" title="三.ES6箭头函数中的this"></a>三.ES6箭头函数中的this</h2><p>箭头函数与其他函数区别很大，我们直接看MDN:</p>
<blockquote>
<p><strong>箭头函数表达式的语法比函数表达式更短，并且没有自己的this，arguments，super或 new.target。</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.age++; <span class="comment">// |this| 正确地指向person 对象</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>
<p>当然，通过相关函数也不能改变=&gt;中的this指向。</p>
<blockquote>
<p><strong>通过 call 或 apply 调用<br>由于 箭头函数没有自己的this指针，通过 call() 或 apply() 方法调用一个函数时，只能传递参数（不能绑定this—译者注），他们的第一个参数会被忽略。（这种现象对于bind方法同样成立—译者注）</strong></p>
</blockquote>
<p><strong>总结一下，在箭头函数中，是没有它自己的this的，它只会从自己的作用域链的上一层继承this。</strong><br>我们来看例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    fn:<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)  <span class="comment">//window</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">obj.fn();</span><br></pre></td></tr></table></figure></p>
<p>再看一个：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">obj</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> aa = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  aa();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj() <span class="comment">// window</span></span><br><span class="line"><span class="keyword">var</span> bb = <span class="keyword">new</span> obj(); <span class="comment">//obj type object</span></span><br></pre></td></tr></table></figure></p>
<p>第二个例子中，new obj()后之所以打印出了obj(),是因为new关键字绑定了this到返回的新的对象object中。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wawisready.github.io/2017/12/11/JavaScript this探究/" data-id="cjtvibba7000auovdxss32g1s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/D3-js/">D3.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Echarts/">Echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端自动化/">前端自动化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/框架/">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试题/">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/D3-js/" style="font-size: 16.67px;">D3.js</a> <a href="/tags/Echarts/" style="font-size: 10px;">Echarts</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/前端自动化/" style="font-size: 13.33px;">前端自动化</a> <a href="/tags/框架/" style="font-size: 10px;">框架</a> <a href="/tags/面试题/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/30/从-Promise-来看-JavaScript-的异步处理/">从 Promise 来看 JavaScript 的异步处理</a>
          </li>
        
          <li>
            <a href="/2018/05/26/UI recorder 自动化UI测试框架使用手册/">UI recorder 自动化UI测试框架使用手册</a>
          </li>
        
          <li>
            <a href="/2018/05/20/原生JS实现并封装前端路由/">原生 JavaScript 实现并封装前端路由</a>
          </li>
        
          <li>
            <a href="/2018/05/19/Karma 自动化测试框架搭建文档/">Karma 自动化测试框架搭建文档</a>
          </li>
        
          <li>
            <a href="/2018/04/06/JavaScript事件委托机制与this的比较/">JavaScript事件委托机制与this的比较</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Eiwen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>